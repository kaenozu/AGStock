# AGStock プロジェクト - 課題と改善提案

## 🚨 修正済みの問題

### 1. `requirements.txt` の破損
- **問題**: ファイル末尾が文字化けしており、`pip install` が失敗する状態でした
- **修正**: `feedparser`, `optuna`, `tensorflow` を正しい形式で記述
- **ステータス**: ✅ 修正完了

### 2. 存在しないスクリプトへの参照
- **問題**: `scripts/run_auto_invest.bat` が存在しない `auto_invest.py` を呼び出していた
- **修正**: 使用されていないバッチファイルを削除
- **ステータス**: ✅ 修正完了

### 3. スクリプト名の不一致
- **問題**: `scripts/run_auto_trader.bat` が `auto_trader.py` を呼び出していたが、実際のファイル名は `fully_automated_trader.py`
- **修正**: バッチファイルを更新して正しいスクリプト名を参照
- **ステータス**: ✅ 修正完了

## 🛠️ 構造的な課題（要検討）

### 1. コードの肥大化
**問題点**:
- `fully_automated_trader.py`: 778行（約33KB）
- `src/strategies.py`: 約48KB
- `src/ui_renderers.py`: 約50KB

**影響**:
- メンテナンスが困難
- テストが書きにくい
- 機能追加時の影響範囲が不明確

**改善案**:
```
fully_automated_trader.py を以下に分割:
- trader_core.py (コアロジック)
- market_scanner.py (市場スキャン)
- position_manager.py (ポジション管理)
- reporter.py (レポート生成)
```

### 2. 設定のハードコード
**問題点**:
- ポートフォリオ目標比率がコード内に直接記述されている
  ```python
  self.target_japan_pct = 40
  self.target_us_pct = 30
  self.target_europe_pct = 10
  ```

**改善案**:
- `config.json` に移動
  ```json
  {
    "portfolio_targets": {
      "japan": 40,
      "us": 30,
      "europe": 10,
      "crypto": 10,
      "fx": 10
    }
  }
  ```

### 3. エラーハンドリングの過度な使用
**問題点**:
- 広範囲な `try-except` ブロックが多用されている
- エラーが発生しても `pass` で無視されるケースが多い
- デバッグが困難

**改善案**:
- より具体的な例外処理
- ログレベルの適切な使用
- クリティカルなエラーは再送出

### 4. テストカバレッジ
**問題点**:
- `tests/` フォルダに69個のテストファイルがあるが、実際のカバレッジは不明
- 統合テストが不足している可能性

**改善案**:
- `pytest-cov` でカバレッジ測定
- CI/CDでカバレッジ閾値を設定（例: 80%以上）

### 5. データベーススキーマの管理
**問題点**:
- `paper_trading.db` のスキーマ管理が不明確
- マイグレーション戦略がない

**改善案**:
- Alembicなどのマイグレーションツール導入
- スキーマバージョン管理

## 💡 機能的な改善提案

### 1. ロギングの統一
**現状**: 各モジュールで独自のログ実装
**提案**: 
- Python標準の `logging` モジュールを統一使用
- ログローテーション設定

### 2. 設定ファイルの検証
**現状**: `config.json` の読み込み時にバリデーションなし
**提案**:
- JSON Schemaでバリデーション
- 不正な設定値の早期検出

### 3. パフォーマンス監視
**現状**: システムパフォーマンスの可視化が不足
**提案**:
- 実行時間のプロファイリング
- メモリ使用量の監視
- ボトルネックの特定

### 4. ドキュメントの整理
**現状**: 
- 22個のマークダウンファイルが `docs/` に存在
- 重複や古い情報が含まれる可能性

**提案**:
- 最新の情報に統合
- 不要なドキュメントをアーカイブ
- README.mdに明確なナビゲーション追加

## 📊 優先度

| 課題 | 優先度 | 工数 | 影響度 |
|------|--------|------|--------|
| requirements.txt修正 | 🔴 高 | 小 | 高 |
| スクリプト参照修正 | 🔴 高 | 小 | 高 |
| コードリファクタリング | 🟡 中 | 大 | 中 |
| 設定外部化 | 🟡 中 | 中 | 中 |
| テストカバレッジ向上 | 🟢 低 | 大 | 中 |
| ドキュメント整理 | 🟢 低 | 中 | 低 |

## 🎯 次のステップ

1. ✅ クリティカルな問題の修正（完了）
2. 🔄 設定ファイルの外部化
3. 🔄 コアモジュールのリファクタリング
4. 🔄 テストカバレッジの測定と改善
5. 🔄 ドキュメントの統合と更新

---
**作成日**: 2025-12-03
**最終更新**: 2025-12-03
