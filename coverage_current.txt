============================= test session starts =============================
platform win32 -- Python 3.11.0, pytest-7.4.2, pluggy-1.6.0
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: C:\gemini-desktop\AGStock
configfile: pytest.ini
plugins: anyio-4.9.0, dash-3.1.1, Faker-37.5.3, logfire-4.0.0, asyncio-0.23.7, benchmark-5.1.0, cov-4.1.0, mock-3.14.1, timeout-2.4.0, xdist-3.8.0, requests-mock-1.12.1, respx-0.22.0, typeguard-4.4.4
asyncio: mode=Mode.STRICT
collected 657 items

tests\test_advanced_features.py ..                                       [  0%]
tests\test_advanced_models.py ..                                         [  0%]
tests\test_advanced_orders.py ....                                       [  1%]
tests\test_agents.py .......                                             [  2%]
tests\test_async_data_loader.py ........                                 [  3%]
tests\test_auth.py .........                                             [  4%]
tests\test_auto_rebalancer_comprehensive.py ......                       [  5%]
tests\test_auto_trader_assets.py .                                       [  5%]
tests\test_auto_trader_ui.py ...                                         [  6%]
tests\test_backtester_comprehensive.py ...........                       [  8%]
tests\test_backtester_risk.py .                                          [  8%]
tests\test_backtester_short.py ..                                        [  8%]
tests\test_backup_manager.py ....F.....                                  [ 10%]
tests\test_benchmark_comparator_coverage.py .........F....               [ 12%]
tests\test_broker.py ......                                              [ 13%]
tests\test_config.py ............                                        [ 14%]
tests\test_config_manager.py ............                                [ 16%]
tests\test_constants.py ................                                 [ 19%]
tests\test_core_enhancements.py ....                                     [ 19%]
tests\test_cost_optimizer.py .......                                     [ 20%]
tests\test_cross_validation.py ..                                        [ 21%]
tests\test_dashboard_utils.py ......                                     [ 22%]
tests\test_data_loader.py .F...............                              [ 24%]
tests\test_data_loader_comprehensive.py ....F.......                     [ 26%]
tests\test_data_manager.py ............                                  [ 28%]
tests\test_db_maintenance_comprehensive.py ........                      [ 29%]
tests\test_dl_strategy.py .                                              [ 29%]
tests\test_dynamic_ensemble.py ....                                      [ 30%]
tests\test_dynamic_stop.py ...............                               [ 32%]
tests\test_ensemble_coverage.py .......                                  [ 33%]
tests\test_error_handling_coverage.py ..................                 [ 36%]
tests\test_execution.py ...................                              [ 39%]
tests\test_execution_real.py ...                                         [ 39%]
tests\test_features_comprehensive.py ..........                          [ 41%]
tests\test_formatters.py ......................................          [ 47%]
tests\test_fully_automated_trader.py FF.......                           [ 48%]
tests\test_fundamentals.py ....................                          [ 51%]
tests\test_hierarchical_strategy.py ...............                      [ 53%]
tests\test_kelly_criterion.py ................                           [ 56%]
tests\test_live_trading.py .....                                         [ 56%]
tests\test_llm_analyzer.py ...                                           [ 57%]
tests\test_logging_config.py ....F....                                   [ 58%]
tests\test_ml_pipeline.py ......                                         [ 59%]
tests\test_ml_strategy.py ...                                            [ 60%]
tests\test_multi_timeframe.py ................                           [ 62%]
tests\test_notifier_comprehensive.py .....                               [ 63%]
tests\test_optimization.py ....                                          [ 63%]
tests\test_optimization_transformer.py .                                 [ 64%]
tests\test_optimizer_new.py ...........                                  [ 65%]
tests\test_paper_trade.py ......                                         [ 66%]
tests\test_patterns_coverage.py .........                                [ 68%]
tests\test_performance.py ..                                             [ 68%]
tests\test_performance_metrics_coverage.py .......................       [ 71%]
tests\test_phase29_integration.py ....                                   [ 72%]
tests\test_phase30_1_integration.py ....                                 [ 73%]
tests\test_phase30_2_mtf.py .                                            [ 73%]
tests\test_phase30_3_risk.py .                                           [ 73%]
tests\test_phase30_full_integration.py F.                                [ 73%]
tests\test_phase35_crypto.py FF..                                        [ 74%]
tests\test_portfolio.py ..                                               [ 74%]
tests\test_portfolio_manager.py ................                         [ 77%]
tests\test_portfolio_optimization.py .                                   [ 77%]
tests\test_pytest_cov_optional.py ..                                     [ 77%]
tests\test_rakuten_broker.py ....                                        [ 78%]
tests\test_rebalancer_coverage.py .............                          [ 80%]
tests\test_regime.py ......                                              [ 80%]
tests\test_regime_detector.py ......................                     [ 84%]
tests\test_risk_guard.py .......                                         [ 85%]
tests\test_risk_limiter.py ..........                                    [ 86%]
tests\test_sector_rotation.py .......                                    [ 87%]
tests\test_sentiment.py .......                                          [ 89%]
tests\test_small_modules.py .........s.                                  [ 90%]
tests\test_smart_notifier_comprehensive.py ........                      [ 91%]
tests\test_strategies.py ...............                                 [ 94%]
tests\test_strategies_base.py ......F.                                   [ 95%]
tests\test_strategies_legacy_coverage.py ......                          [ 96%]
tests\test_transformer_model.py ....F....FF.                             [ 98%]
tests\test_ui_renderers.py .....                                         [ 98%]
tests\test_visualizer.py .......                                         [100%]

================================== FAILURES ===================================
_____________________ TestBackupManager.test_list_backups _____________________
tests\test_backup_manager.py:92: in test_list_backups
    assert len(backups) == 2
E   AssertionError: assert 1 == 2
E    +  where 1 = len([{'created': datetime.datetime(2025, 12, 4, 19, 48, 22, 336087), 'filename': 'paper_trading_20251204_194822.db', 'path': 'C:\\Users\\neoen\\AppData\\Local\\Temp\\tmpfxdjow4a\\paper_trading_20251204_194822.db', 'size_mb': 0.0078125}])
---------------------------- Captured stderr call -----------------------------
2025-12-04 19:48:22,342 - src.backup_manager - INFO - Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpfxdjow4a\paper_trading_20251204_194822.db
2025-12-04 19:48:22,447 - src.backup_manager - INFO - Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpfxdjow4a\paper_trading_20251204_194822.db
------------------------------ Captured log call ------------------------------
INFO     src.backup_manager:backup_manager.py:63 Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpfxdjow4a\paper_trading_20251204_194822.db
INFO     src.backup_manager:backup_manager.py:63 Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpfxdjow4a\paper_trading_20251204_194822.db
___________ TestBenchmarkComparator.test_generate_comparison_report ___________
tests\test_benchmark_comparator_coverage.py:113: in test_generate_comparison_report
    assert 'benchmark' in report
E   AssertionError: assert 'benchmark' in {'active_return': 0.3568858990738333, 'alpha': 11.420837964952083, 'benchmark_name': 'nikkei225', 'benchmark_return': 10.08711065222434, ...}
_______________ TestFetchStockData.test_fetch_multiple_tickers ________________
tests\test_data_loader.py:94: in test_fetch_multiple_tickers
    assert '7203.T' in result
E   AssertionError: assert '7203.T' in {}
---------------------------- Captured stdout call -----------------------------
7203.T: No data found for this date range, symbol may be delisted9984.T: No data found for this date range, symbol may be delisted

---------------------------- Captured stderr call -----------------------------
2025-12-04 19:48:27,096 - src.async_data_loader - WARNING - Empty DataFrame for 7203.T
2025-12-04 19:48:27,097 - src.async_data_loader - WARNING - Empty DataFrame for 9984.T
2025-12-04 19:48:27,098 - src.async_data_loader - INFO - Successfully fetched 0/2 tickers
------------------------------ Captured log call ------------------------------
WARNING  src.async_data_loader:async_data_loader.py:110 Empty DataFrame for 7203.T
WARNING  src.async_data_loader:async_data_loader.py:110 Empty DataFrame for 9984.T
INFO     src.async_data_loader:async_data_loader.py:192 Successfully fetched 0/2 tickers
______________________________ test_parse_period ______________________________
tests\test_data_loader_comprehensive.py:103: in test_parse_period
    d_invalid = parse_period('invalid')
src\data_loader.py:88: in parse_period
    days = int(period[:-1])
E   ValueError: invalid literal for int() with base 10: 'invali'
________________ TestFullyAutomatedTrader.test_initialization _________________
tests\test_fully_automated_trader.py:55: in test_initialization
    assert trader.target_japan_pct == 60.0
E   assert 40 == 60.0
E    +  where 40 = <fully_automated_trader.FullyAutomatedTrader object at 0x000002090D9E3B90>.target_japan_pct
---------------------------- Captured stdout setup ----------------------------
[2025-12-04 19:48:28] [INFO] Phase 30-1 & 30-3: リアルタイム適応学習・高度リスク管理モジュール初期化完了
[2025-12-04 19:48:28] [INFO] フル自動トレーダー初期化完了
---------------------------- Captured stderr setup ----------------------------
2025-12-04 19:48:28,073 - src.regime_detector - INFO - MarketRegimeDetector initialized
2025-12-04 19:48:28,074 - src.dynamic_risk_manager - INFO - DynamicRiskManager initialized
----------------------------- Captured log setup ------------------------------
INFO     src.regime_detector:regime_detector.py:35 MarketRegimeDetector initialized
INFO     src.dynamic_risk_manager:dynamic_risk_manager.py:34 DynamicRiskManager initialized
______________ TestFullyAutomatedTrader.test_calculate_daily_pnl ______________
tests\test_fully_automated_trader.py:70: in test_calculate_daily_pnl
    assert pnl == 1000  # 今日の取引のみ
E   assert 0.0 == 1000
---------------------------- Captured stdout setup ----------------------------
[2025-12-04 19:48:28] [INFO] Phase 30-1 & 30-3: リアルタイム適応学習・高度リスク管理モジュール初期化完了
[2025-12-04 19:48:28] [INFO] フル自動トレーダー初期化完了
---------------------------- Captured stderr setup ----------------------------
2025-12-04 19:48:28,096 - src.regime_detector - INFO - MarketRegimeDetector initialized
2025-12-04 19:48:28,097 - src.dynamic_risk_manager - INFO - DynamicRiskManager initialized
----------------------------- Captured log setup ------------------------------
INFO     src.regime_detector:regime_detector.py:35 MarketRegimeDetector initialized
INFO     src.dynamic_risk_manager:dynamic_risk_manager.py:34 DynamicRiskManager initialized
____________________ test_setup_logging_creates_directory _____________________
tests\test_logging_config.py:107: in test_setup_logging_creates_directory
    setup_logging(log_dir=str(log_dir))
src\logging_config.py:57: in setup_logging
    file_handler = logging.handlers.RotatingFileHandler(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\handlers.py:155: in __init__
    BaseRotatingHandler.__init__(self, filename, mode, encoding=encoding,
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\handlers.py:58: in __init__
    logging.FileHandler.__init__(self, filename, mode=mode,
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\__init__.py:1181: in __init__
    StreamHandler.__init__(self, self._open())
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\__init__.py:1213: in _open
    return open_func(self.baseFilename, self.mode,
E   FileNotFoundError: [Errno 2] No such file or directory: 'C:\\Users\\neoen\\AppData\\Local\\Temp\\pytest-of-neoen\\pytest-246\\test_setup_logging_creates_dir0\\test_logs\\agstock.log'
_____________ TestPhase30FullIntegration.test_dynamic_stop_update _____________
tests\test_phase30_full_integration.py:143: in test_dynamic_stop_update
    self.assertEqual(pos['highest_price'], 1100.0)
E   AssertionError: 1000.0 != 1100.0
---------------------------- Captured stdout call -----------------------------
[2025-12-04 19:48:36] [INFO] Phase 30-1 & 30-3: \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u9069\u5fdc\u5b66\u7fd2\u30fb\u9ad8\u5ea6\u30ea\u30b9\u30af\u7ba1\u7406\u30e2\u30b8\u30e5\u30fc\u30eb\u521d\u671f\u5316\u5b8c\u4e86\n[2025-12-04 19:48:36] [INFO] \u30d5\u30eb\u81ea\u52d5\u30c8\u30ec\u30fc\u30c0\u30fc\u521d\u671f\u5316\u5b8c\u4e86\n\nTesting Dynamic Stop Update...\n\u2705 BUY Executed: 7203.T x 100 @ 1000.0\nUpdated Position after rise: Stop=0.0, High=1000.0
__________________________ test_crypto_data_loading ___________________________
tests\test_phase35_crypto.py:14: in test_crypto_data_loading
    assert "BTC-USD" in data_map
E   AssertionError: assert 'BTC-USD' in {}
---------------------------- Captured stdout call -----------------------------

[*********************100%***********************]  1 of 1 completed

1 Failed download:
- BTC-USD: No data found for this date range, symbol may be delisted
____________________________ test_fx_data_loading _____________________________
tests\test_phase35_crypto.py:27: in test_fx_data_loading
    assert "USDJPY=X" in data_map
E   AssertionError: assert 'USDJPY=X' in {}
---------------------------- Captured stdout call -----------------------------

[*********************100%***********************]  1 of 1 completed

1 Failed download:
- USDJPY=X: No data found for this date range, symbol may be delisted
_____________________________ test_analyze_empty ______________________________
tests\test_strategies_base.py:106: in test_analyze_empty
    result = strategy.analyze(pd.DataFrame())
src\strategies\base.py:104: in analyze
    signals = self.generate_signals(df)
tests\test_strategies_base.py:16: in generate_signals
    signals[df['Close'] > df['Open']] = 1
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\frame.py:3761: in __getitem__
    indexer = self.columns.get_loc(key)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\indexes\range.py:349: in get_loc
    raise KeyError(key)
E   KeyError: 'Close'
____________ TestTemporalFusionTransformer.test_attention_weights _____________
tests\test_transformer_model.py:132: in test_attention_weights
    assert np.abs(attention_weights.sum() - X.shape[1]) < 1e-5
E   AssertionError: assert 34332150.0 < 1e-05
E    +  where 34332150.0 = <ufunc 'absolute'>((34332180.0 - 30))
E    +    where <ufunc 'absolute'> = np.abs
E    +    and   34332180.0 = <built-in method sum of numpy.ndarray object at 0x0000020931BC3750>()
E    +      where <built-in method sum of numpy.ndarray object at 0x0000020931BC3750> = array([[1162513.4 , 1874996.2 , 2058367.2 ,  279320.22, 2223524.  ,\n         761711.6 ,  909849.1 , 1988094.2 , 168426....25,  225677.4 ,  896366.25,\n        1531027.5 , 1544386.8 , 1137844.8 , 1179022.5 ,  400615.3 ]],\n      dtype=float32).sum
___________ TestTransformerStrategy.test_strategy_confidence_score ____________
tests\test_transformer_model.py:233: in test_strategy_confidence_score
    confidence = strategy.get_confidence()
E   AttributeError: 'TransformerStrategy' object has no attribute 'get_confidence'
---------------------------- Captured stderr call -----------------------------
2025-12-04 19:49:06,438 - src.strategies_legacy - ERROR - Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
2025-12-04 19:49:06,438 - src.strategies_legacy - ERROR - Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
2025-12-04 19:49:06,438 - src.strategies_legacy - ERROR - Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
------------------------------ Captured log call ------------------------------
ERROR    src.strategies_legacy:strategies_legacy.py:698 Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
__________ TestTransformerIntegration.test_ensemble_with_transformer __________
tests\test_transformer_model.py:247: in test_ensemble_with_transformer
    ensemble = CombinedStrategy(
E   TypeError: CombinedStrategy.__init__() got an unexpected keyword argument 'strategies'
============================== warnings summary ===============================
..\..\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\tensorflow\lite\python\util.py:51
..\..\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\tensorflow\lite\python\util.py:51
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\tensorflow\lite\python\util.py:51: DeprecationWarning: jax.xla_computation is deprecated. Please use the AOT APIs.
    from jax import xla_computation as _xla_computation

..\..\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\streamlit\elements\image.py:22
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\streamlit\elements\image.py:22: DeprecationWarning: 'imghdr' is deprecated and slated for removal in Python 3.13
    import imghdr

tests/test_phase29_integration.py::test_advanced_features
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_advanced_features returned False, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase29_integration.py::test_stacking_ensemble
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_stacking_ensemble returned False, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase29_integration.py::test_hyperparameter_tuning
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_hyperparameter_tuning returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase29_integration.py::test_performance_monitor
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_performance_monitor returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_online_learning
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_online_learning returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_regime_detector
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_regime_detector returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_dynamic_risk_manager
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_dynamic_risk_manager returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_integration
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_integration returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_pytest_cov_optional.py::test_registers_cov_options_when_plugin_missing
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\dash\testing\plugin.py:104: PytestDeprecationWarning: The hookimpl pytest_addhooks uses old-style configuration options (marks or attributes).
  Please use the pytest.hookimpl(tryfirst=True) decorator instead
   to configure the hooks.
   See https://docs.pytest.org/en/latest/deprecations.html#configuring-hook-specs-impls-using-markers
    @pytest.mark.tryfirst

tests/test_pytest_cov_optional.py::test_registers_cov_options_when_plugin_missing
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\config\__init__.py:331: PluggyTeardownRaisedWarning: A plugin raised an exception during an old-style hookwrapper teardown.
  Plugin: helpconfig, Hook: pytest_cmdline_parse
  ArgumentError: argument --cov: conflicting option string: --cov
  For more information see https://pluggy.readthedocs.io/en/stable/api_reference.html#pluggy.PluggyTeardownRaisedWarning
    config = pluginmanager.hook.pytest_cmdline_parse(

tests/test_transformer_model.py::TestTemporalFusionTransformer::test_model_save_and_load
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\keras\src\engine\training.py:3103: UserWarning: You are saving your model as an HDF5 file via `model.save()`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')`.
    saving_api.save_model(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.0-final-0 -----------
Name                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------
src\advanced_backtest.py                   101    101     0%   6-282
src\advanced_features.py                   124     11    91%   39, 74, 107, 150, 174-175, 225, 273, 311-312, 332
src\advanced_models.py                      41      4    90%   35-41
src\advanced_risk.py                        89     89     0%   6-234
src\agents.py                              173     43    75%   24, 33, 59-69, 81, 91, 93, 110-115, 121-127, 131-137, 142-143, 145-146, 157, 181-188, 249
src\ai_analyst.py                           46     46     0%   5-97
src\alert_manager.py                       126    126     0%   5-270
src\alert_system.py                        125    125     0%   9-344
src\anomaly_detector.py                     90     90     0%   5-208
src\async_data_loader.py                   143     61    57%   57-63, 79, 82-96, 106-107, 114-127, 186-187, 190, 219-220, 226-229, 249-255, 260-265, 310-328
src\auth.py                                152     25    84%   87, 90, 93, 139, 235-238, 249-250, 287-291, 297-317
src\auto_rebalancer.py                     132     31    77%   50-51, 73-75, 109-110, 125-126, 142, 154-158, 173-174, 185, 196-198, 256-260, 272-278
src\auto_trader_ui.py                      107     74    31%   12-27, 30-36, 39-40, 43-56, 60-129, 144
src\backtest_engine.py                      45     41     9%   5-86
src\backtest_visualizer.py                  81     81     0%   6-314
src\backtester.py                          232     21    91%   83, 89, 94, 254, 272-274, 285-287, 300, 304-322
src\backup_manager.py                      115     31    73%   70-78, 104-106, 128, 144-145, 161, 177-178, 205-206, 220-222, 239-254
src\base.py                                120     51    58%   46-48, 53, 57-61, 68-70, 75, 79-83, 90-91, 96, 101, 105-113, 122, 127, 132, 137, 146, 151, 156, 161, 173-176, 180-186, 190-192
src\benchmark_comparator.py                 99     27    73%   38-48, 126, 178, 248-269
src\bert_sentiment.py                       72     27    62%   39-42, 55, 98-100, 104-128
src\broker.py                               42      7    83%   40, 45, 50, 55, 60, 65, 70
src\cache_config.py                          8      6    25%   9-20
src\cloud_storage.py                        79     37    53%   23-32, 40, 48, 55-57, 68-69, 80-82, 86-92, 96-106
src\config.py                               46      0   100%
src\config_manager.py                       47      4    91%   89-93
src\constants.py                            10      0   100%
src\copy_trading.py                        149    149     0%   5-382
src\cost_optimizer.py                      125     62    50%   56, 78-80, 157, 161, 184, 199, 216-228, 272-281, 286-343, 347
src\cross_validation.py                     43      1    98%   143
src\dashboard_utils.py                      36      1    97%   40
src\data_loader.py                         120     15    88%   33-35, 62-64, 69, 91, 113-115, 119-120, 139-140
src\data_manager.py                         84     10    88%   63, 111-112, 142-144, 162-163, 173-174
src\db_maintenance.py                       86     18    79%   84-85, 97-99, 126-128, 132-144
src\design_tokens.py                        52      0   100%
src\dividend_strategy.py                    71     71     0%   6-236
src\dynamic_ensemble.py                     77     16    79%   56, 65, 99-100, 127-129, 142-143, 148-154
src\dynamic_risk_manager.py                 89     31    65%   108-110, 150-153, 175, 198, 218-232, 241, 260, 266-299
src\dynamic_risk_manager_refactored.py     121    121     0%   6-337
src\dynamic_stop.py                         52      2    96%   67-68
src\encryption.py                           74     74     0%   5-188
src\enhanced_performance_dashboard.py      144    144     0%   5-323
src\ensemble.py                             27      1    96%   52
src\error_handler.py                       109    109     0%   6-215
src\error_handling.py                       88     19    78%   82, 87, 124, 132, 286-301
src\execution.py                            78      0   100%
src\execution_optimizer.py                  69     69     0%   6-213
src\export_manager.py                       80     80     0%   5-175
src\factor_analyzer.py                      85     85     0%   6-269
src\features.py                            122     11    91%   60, 100, 105, 137-139, 146-147, 219, 225, 232
src\formatters.py                           83      2    98%   123-124
src\fundamentals.py                         26      2    92%   34, 48
src\hierarchical_strategy.py                42      2    95%   37-38
src\hyperparameter_tuning.py               111     53    52%   60, 158-172, 207-210, 235-238, 247-269, 281-287, 304-338, 342-349
src\ibkr_broker.py                          88     88     0%   1-154
src\integrated_signals.py                   69     69     0%   7-160
src\kelly_criterion.py                      35      1    97%   78
src\liquidity_analyzer.py                   74     74     0%   6-233
src\live_trading.py                        151     37    75%   47-48, 66, 70, 74, 100-103, 115, 126, 131-133, 177, 182-183, 188-189, 199-201, 207-208, 230-231, 239-244, 252-256, 259-260
src\llm_analyzer.py                         69     12    83%   12-15, 32-33, 84, 86, 89-91, 121
src\logging_config.py                       45      8    82%   93-102
src\macro_analyzer.py                       89     89     0%   6-208
src\meta_learner.py                        107    107     0%   5-264
src\metrics_collector.py                    87     87     0%   5-197
src\ml_pipeline.py                          89     20    78%   30-35, 42-43, 77-79, 86, 95-97, 105, 112, 119-121
src\monitoring_dashboard.py                 96     96     0%   5-174
src\mpt_optimizer.py                       102    102     0%   6-302
src\multi_timeframe.py                      77     24    69%   116, 118, 154-182, 188-190
src\nisa_manager.py                        115    115     0%   5-342
src\notifier.py                             81      1    99%   22
src\online_learning.py                     113     59    48%   72, 83-85, 163-171, 180-193, 202-219, 228-241, 250-255, 272-286, 291-315
src\optimization.py                        204    150    26%   26-28, 51-81, 93-138, 177-260, 289-356, 381-430
src\optimizer.py                            47      0   100%
src\options_pricing.py                      89     89     0%   5-264
src\paper_trader.py                        144     50    65%   13-24, 60-66, 115, 144, 148-168, 204-207, 243, 274-294
src\parallel_backtester.py                  76     76     0%   5-228
src\patterns.py                             91     12    87%   38, 64, 77, 84, 106, 120, 137, 145, 175-179
src\pdf_report_generator.py                 94     94     0%   5-187
src\performance.py                         167    154     8%   19, 23, 32-91, 100-177, 186-241, 250-270, 283-320
src\performance_attribution.py              95     95     0%   5-232
src\performance_metrics.py                  97     13    87%   37, 54, 121, 200-213
src\performance_monitor.py                 111    111     0%   10-314
src\performance_optimizer.py               113    113     0%   11-184
src\personal_features.py                   195    195     0%   6-345
src\portfolio.py                           131     74    44%   23, 46, 56, 72, 81, 87, 98, 126-142, 157-243
src\portfolio_manager.py                    42      2    95%   58-59
src\portfolio_manager_refactored.py        109    109     0%   6-263
src\portfolio_optimizer.py                 111    111     0%   6-269
src\production_manager.py                  101    101     0%   11-219
src\prompts.py                               3      0   100%
src\psychological_guard.py                  84     84     0%   6-294
src\pytest_cov_optional.py                  13      2    85%   14-15
src\rakuten_broker.py                      153     68    56%   43-49, 53-77, 82, 93-95, 116-118, 122-132, 137-138, 158-161, 166-167, 180-181, 203-204, 226-231, 235-238, 250-259
src\realtime_alerts.py                     129    129     0%   8-309
src\realtime_data.py                        96     96     0%   8-182
src\rebalancer.py                           84     29    65%   124-126, 140, 194-205, 210-246
src\recovery_manager.py                    107    107     0%   5-217
src\regime.py                              100     11    89%   62-63, 91-93, 103-105, 190-191, 196, 225, 230
src\regime_detector.py                     110     23    79%   100-103, 107-109, 129, 133, 174-176, 196, 200, 330-352
src\rich_notifier.py                       106    106     0%   5-291
src\risk_guard.py                          102      8    92%   41, 61-62, 76-77, 168, 172, 193
src\risk_limiter.py                        135     17    87%   191-221, 225
src\rl_agent.py                             74     74     0%   1-106
src\rl_environment.py                       65     65     0%   1-145
src\sector_rotation.py                      83      9    89%   47, 53-54, 77, 126, 144-145, 160, 173
src\sentiment.py                            74     11    85%   42-43, 61, 77, 79, 168-173
src\simple_dashboard.py                    113    113     0%   6-257
src\smart_notifier.py                       63      8    87%   51-52, 62-63, 69, 85-87
src\stacking_ensemble.py                   107     81    24%   71-97, 122-176, 188-197, 210-211, 220-231, 248-283, 287-293
src\strategies\__init__.py                   7      0   100%
src\strategies\base.py                      50      1    98%   106
src\strategies\custom\__init__.py            0      0   100%
src\strategies_legacy.py                   725    454    37%   15-20, 24-26, 71, 78-85, 91-95, 105, 135, 142, 158, 168, 188, 199, 222-224, 234, 275, 290-294, 311-312, 320, 341-358, 361-365, 380-384, 387-392, 396, 406-467, 470-474, 483-486, 489-491, 495-535, 548-615, 619-625, 629-658, 684-695, 704-725, 733-736, 742-798, 802-820, 827-830, 833-858, 861-885, 892-895, 898-922, 925-949, 958-970, 973-992, 1003, 1007-1016, 1040-1042, 1045-1095, 1098-1103, 1115-1116, 1119-1131, 1134-1138
src\strategy_marketplace.py                134    134     0%   5-381
src\streaming_pipeline.py                   84     84     0%   7-202
src\tax_calculator.py                       82     82     0%   5-280
src\tax_report_generator.py                 85     85     0%   5-268
src\trade_explainer.py                      32     32     0%   5-99
src\trader_profile.py                      123    123     0%   5-397
src\trading_performance_monitor.py          98     46    53%   168, 193-236, 251, 288-348, 352-360
src\transformer_model.py                   107     19    82%   19-20, 169, 239, 255, 272, 306-339
src\ui_advanced_analytics.py               157    157     0%   5-291
src\ui_ai_chat.py                           46     46     0%   4-76
src\ui_ai_report.py                         48     48     0%   4-80
src\ui_alerts.py                            79     79     0%   4-158
src\ui_automation.py                        77     77     0%   5-132
src\ui_components.py                       130    130     0%   5-327
src\ui_customizer.py                        82     82     0%   5-240
src\ui_export.py                            83     83     0%   4-162
src\ui_renderers.py                        560    495    12%   71-75, 102-118, 126-136, 152, 163-164, 171-198, 204-299, 306-802, 808-920, 931-970, 977-1044
src\ui_risk_dashboard.py                   118    118     0%   5-232
src\visualizer.py                           75      8    89%   23-24, 98-100, 155-157
src\xai.py                                  78     78     0%   8-227
----------------------------------------------------------------------
TOTAL                                    13053   8347    36%
Coverage HTML written to dir htmlcov

=========================== short test summary info ===========================
FAILED tests/test_backup_manager.py::TestBackupManager::test_list_backups - A...
FAILED tests/test_benchmark_comparator_coverage.py::TestBenchmarkComparator::test_generate_comparison_report
FAILED tests/test_data_loader.py::TestFetchStockData::test_fetch_multiple_tickers
FAILED tests/test_data_loader_comprehensive.py::test_parse_period - ValueErro...
FAILED tests/test_fully_automated_trader.py::TestFullyAutomatedTrader::test_initialization
FAILED tests/test_fully_automated_trader.py::TestFullyAutomatedTrader::test_calculate_daily_pnl
FAILED tests/test_logging_config.py::test_setup_logging_creates_directory - F...
FAILED tests/test_phase30_full_integration.py::TestPhase30FullIntegration::test_dynamic_stop_update
FAILED tests/test_phase35_crypto.py::test_crypto_data_loading - AssertionErro...
FAILED tests/test_phase35_crypto.py::test_fx_data_loading - AssertionError: a...
FAILED tests/test_strategies_base.py::test_analyze_empty - KeyError: 'Close'
FAILED tests/test_transformer_model.py::TestTemporalFusionTransformer::test_attention_weights
FAILED tests/test_transformer_model.py::TestTransformerStrategy::test_strategy_confidence_score
FAILED tests/test_transformer_model.py::TestTransformerIntegration::test_ensemble_with_transformer
====== 14 failed, 642 passed, 1 skipped, 14 warnings in 97.62s (0:01:37) ======
