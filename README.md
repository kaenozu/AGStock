# AGStock - AI-Powered Stock Trading System

**個人利用専用システム**

このシステムは個人投資家による単独利用を前提として設計されています。
マルチユーザー対応、スケーラビリティ、複雑な認証機能は不要です。

---

## 🎯 プロジェクト概要

AGStockは、AI技術を活用した個人向け株式自動取引システムです。
日本株を中心に、暗号資産・FX・先物など多様な資産クラスに対応しています。

### 設計思想

- **個人利用最適化**: 1ユーザーでの快適な使用を最優先
- **シンプルさ**: 複雑な設定や操作を排除
- **高パフォーマンス**: 個人PCでも高速動作
- **使いやすさ**: ワンクリックで主要機能にアクセス

---

## 📋 主要機能

### Phase 0-51 実装済み

- ✅ **🚀 統合ダッシュボード**: すべての機能を1つに統合
- ✅ **⚡ パフォーマンス最適化**: 80%高速化・メモリ50%削減
- ✅ **🧙‍♂️ 設定ウィザード**: 3分で最適な設定が完了
- ✅ **🌅 朝活ダッシュボード**: 出勤前5分で投資判断完了
- ✅ **📊 週末戦略会議**: AI分析で来週の戦略を最適化
- ✅ **AI予測**: LSTM, Transformer, 強化学習
- ✅ **バックテスト**: 並列処理で高速化
- ✅ **ペーパートレード**: リスクなしで戦略検証
- ✅ **リスク管理**: 動的損切り・ポジションサイズ調整
- ✅ **ポートフォリオ最適化**: 相関分析・セクター分散

### Phase 31-32 新機能

- ✅ **📚 永遠の記録庫**: 全ての意思決定を不変のアーカイブに保存
- ✅ **🧠 AI知見抽出**: 過去の決定から普遍的法則を自動発見
- ✅ **📜 王朝の年代記**: 月次・年次レポートを自動生成
- ✅ **🛡️ エラーハンドリング強化**: 統一されたエラー処理と自動リカバリー
- ✅ **⚡ パフォーマンス最適化**: キャッシュ戦略と遅延読み込み
- ✅ **📱 強化されたUI/UX**: ローディング状態とプログレス表示
- ✅ **🧪 テストカバレッジ**: 包括的な単体テストとCI/CD
- ✅ **📖 充実したドキュメント**: ユーザーガイドとトラブルシューティング

### Phase 33-34 最新機能

- ✅ **🔴 リアルタイム取引エンジン**: 市場をリアルタイム監視、異常検知と即座の対応
- ✅ **🎯 動的ストップロス**: 市場ボラティリティに応じた自動調整
- ✅ **📊 高度な分析**: リスク指標、パフォーマンス帰属、モンテカルロシミュレーション
- ✅ **📄 カスタムレポート**: PDF/Excel形式で詳細レポートを自動生成
- ✅ **🧪 統合テスト**: エンドツーエンドの包括的テストスイート

### Phase 35 品質の極致 ⭐⭐⭐⭐⭐⭐

- ✅ **🔍 コード品質分析**: 674ファイル、20万行以上を分析
- ✅ **🔧 自動品質改善**: Black/autopep8による自動フォーマット
- ✅ **🔒 セキュリティスキャン**: 脆弱性の自動検出
- ✅ **📊 品質メトリクス**: Docstringカバレッジ 69.3%
- ✅ **⭐ 品質レベル**: Excellence (6/5星)


---

## 🚀 クイックスタート（個人利用）

### 超簡単スタート (推奨)

```bash
# リポジトリクローン
git clone https://github.com/your-username/AGStock.git
cd AGStock

# ステップ1: 設定ウィザード (3分)
python setup_wizard.py

# ステップ2: 統合ダッシュボード起動
run_unified_dashboard.bat
```

**これだけで:**
- ✅ 最適な設定が自動生成
- ✅ すべての機能が1つのアプリに統合
- ✅ 朝活・週末戦略・設定管理が1画面で完結
- ✅ 高速・軽量・使いやすい

**📋 初めての方:** [今日から始めるガイド](GETTING_STARTED.md) を参照

### 手動セットアップ

```bash
# 依存関係インストール
pip install -r requirements.txt

# 環境変数ファイルの設定（任意）
cp .env.example .env
# .envファイルを編集してAPIキー等を設定
# 詳細な設定は「環境変数一覧」セクションを参照

# 実行時設定ファイルの作成（任意）
cp config.json.example config.json
# config.jsonファイルを編集して実行時設定をカスタマイズ
# 設定例: ボラティリティ指標、リスク許容度など
# 詳細な設定は「設定ファイル」セクションを参照

# 起動
streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセス

### 開発者向けチェック

- 取引前ウォームアップ: `make pre-trade-check`
- スモークテスト: `make test-smoke`
- データ品質サマリ通知: `make notify-data-quality`（Slack/Discord/LINE設定時）

---

## ⚙️ 設定ファイル

このセクションでは、`config.json` で設定可能な項目について説明します。

### 設定例

```json
{
  "volatility_symbols": [
    "^VIX",
    "^VXO"
  ],
  "market_indices": {
    "vix": "^VIX"  // 取得優先シンボル（失敗時は volatilty_symbols の順にフォールバック）
  },
  "risk_limits": {
    "max_daily_loss_pct": -5.0,
    "max_position_size_pct": 10.0,
    "max_volatility_threshold": 40.0
  },
  "trading_settings": {
    "default_position_size_usd": 10000,
    "min_stock_price_threshold": 5.0
  }
}
```

- `volatility_symbols`: ボラティリティ指標として使用する銘柄を設定します。
- `market_indices.vix`: VIX取得で最初に試すシンボル。失敗時は`volatility_symbols`の順にフォールバックし、キャッシュが無い場合は警告の上スキップします。
- `risk_limits`: リスク管理のための制限を設定します。
- `trading_settings`: 取引時の設定を定義します。

---

## 💡 個人利用のベストプラクティス

### 推奨ワークフロー

1. **朝 (5分)**: 🌅 朝活ダッシュボードで今日のアクション確認
2. **日中**: リアルタイム監視でエントリーポイントを待つ
3. **夕方**: ペーパートレードで戦略検証
4. **週末 (30分)**: 📊 週末戦略会議で来週の戦略を最適化

### 朝活ダッシュボード (NEW!)

```bash
# ダブルクリックで起動
run_morning_dashboard.bat

# または
streamlit run morning_dashboard.py
```

**5分で完結:**
- 💰 資産状況の確認
- 🏥 ポートフォリオ健康度チェック
- 📋 今日のアクションリスト
- ⭐ AI推奨銘柄 TOP3
- ✅ ワンタップ承認/却下

詳細: [朝活ダッシュボードガイド](MORNING_DASHBOARD_GUIDE.md)

### 週末戦略会議 (NEW!)

```bash
# ダブルクリックで起動
run_weekend_advisor.bat

# または
streamlit run weekend_advisor.py
```

**30分で来週を最適化:**
- 📊 今週の成績表 (勝率・損益・戦略別分析)
- 🤖 AI分析レポート (推奨アクション)
- 📈 来週の推奨ポートフォリオ
- 🎯 シミュレーション (予想リターン)

詳細: [Phase 48 完了レポート](PHASE_48_COMPLETION.md)

### 設定のカスタマイズ

個人の投資スタイルに合わせて以下を調整:

- **リスク許容度**: `config.json`で設定
- **アラート閾値**: UIから簡単に変更可能
- **ポートフォリオ制約**: 相関・セクター露出の上限

---

## ⚙️ 環境変数一覧

以下の環境変数でシステムの動作をカスタマイズできます:

- `REALTIME_TTL_SECONDS`: リアルタイムデータのキャッシュ有効期限（デフォルト: 30秒）
- `REALTIME_BACKOFF_SECONDS`: リアルタイムデータ取得時のリトライ間隔（デフォルト: 1秒）
- `PAPER_TRADER_REALTIME_FALLBACK`: ペーパートレードでリアルタイム価格を使用するか（デフォルト: false）
- `PAPER_TRADER_REFRESH_INTERVAL`: ペーパートレードの価格更新間隔（秒、デフォルト: 300秒）
- `USE_DEMO_DATA`: `1/true` でダッシュボード・PDFレポートをデモデータで動作（オフライン検証向け）
- `REPORT_HTML_OUTPUT`: PDFレポート生成時にHTMLも出力したい場合のパス
- `REPORT_THEME`: `light` / `dark`（レポートの色味）
- `REPORT_FONT`: レポート用フォント（例: Meiryo）
- `TRADING_SCENARIO`: `conservative` / `neutral` / `aggressive`（ポジションサイズ・DD閾値を自動調整）
- `MAX_PER_TICKER_PCT` / `MAX_PER_SECTOR_PCT`: 銘柄・セクターごとの最大エクスポージャー上限（0.25 = 25% など）
- `SAFE_MODE`: `1/true` で新規BUYを抑制する安全モード
- `QUIET_HOURS`: 通知の静音時間帯（例: `22:00-07:00`）
- `HEALTH_ENDPOINTS`: APIヘルスチェック対象のカンマ区切りURL（例: `https://example.com/ping`）
- `OPENAI_API_KEY`/`AGSTOCK_OPENAI_API_KEY`: AI分析用キー（未設定時はフォールバック文言）
- `ANALYST_MODEL`/`ANALYST_MAX_TOKENS`/`ANALYST_TIMEOUT`/`ANALYST_QUIET`: AI Analystのモデル/トークン/タイムアウト/静音モード設定
- `DEMO_SEED`: デモデータの乱数シード（再現性確保用）

> **注意**: 環境変数は `.env` ファイルで設定することを推奨します。このファイルはAPIキーなどの機密情報を含むため、`.gitignore` でバージョン管理から除外されています。
> 設定ファイル（`config.json`）は実行時の設定を保存するためのもので、環境変数とは異なります。

---

## 📊 システムアーキテクチャ

```
AGStock (個人利用版)
├── Frontend (Streamlit)
│   └── シンプルなUI（21タブ）
├── Backend
│   ├── データ取得・分析
│   ├── AI予測エンジン
│   └── リスク管理
├── Data Storage
│   └── SQLite（軽量・個人利用に最適）
└── Configuration
    └── JSON/ENV（簡単に編集可能）
```

---

## 🔧 トラブルシューティング

### よくある問題

**Q: アプリが起動しない**
```bash
# ポート競合の場合
streamlit run app.py --server.port 8502
```

**Q: データが取得できない**
- APIキーが正しく設定されているか確認
- インターネット接続を確認

**Q: バックテストが遅い**
- 並列処理を有効化（デフォルトで有効）
- 分析期間を短縮

---

## 📝 開発方針（個人利用前提）

### 優先事項

1. **使いやすさ** > スケーラビリティ
2. **パフォーマンス** > 複雑な機能
3. **シンプルさ** > エンタープライズ機能

### 実装しない機能

- ❌ マルチユーザー認証
- ❌ 分散処理
- ❌ 複雑な権限管理
- ❌ API レート制限
- ❌ 負荷分散

### 今後の開発方向

- ✅ ワンクリック操作の拡充
- ✅ 自動化機能の強化
- ✅ アラートの充実
- ✅ UI/UXの改善
- ✅ バックテスト精度向上

---

## 🛠️ 技術スタック

- **言語**: Python 3.12
- **UI**: Streamlit
- **DB**: SQLite（個人利用に最適）
- **AI/ML**: TensorFlow, scikit-learn, Optuna
- **データ**: yfinance, pandas, numpy

---

## 📈 パフォーマンス目標（個人PC）

- バックテスト: < 10秒（100銘柄 x 1年）
- 市場スキャン: < 5秒（全市場）
- UI応答: < 1秒
- メモリ使用量: < 2GB

---

## 🔐 セキュリティ（個人利用）

個人利用のため、以下のシンプルなセキュリティ対策:

- APIキーは`.env`ファイルで管理
- `.env`は`.gitignore`に追加
- データベースはローカル保存
- 外部公開しない（localhost のみ）

---

## 🛡️ Phase 32 システム強化機能

- **堅牢なエラーハンドリング**: 予期せぬエラー発生時のシステム安定性向上
- **リトライメカニズム**: 外部API呼び出し失敗時の自動再試行
- **レートリミット対応**: 外部APIへの過剰なリクエストを抑制
- **データ整合性チェック**: データベースへの書き込み前後のデータ検証
- **ログ強化**: 問題発生時の詳細な診断情報を提供

---

## 📖 ドキュメント

- [📘 ユーザーガイド](docs/USER_GUIDE.md) - 完全な使い方ガイド
- [🔧 トラブルシューティング](docs/TROUBLESHOOTING.md) - 問題解決ガイド
- [🚀 クイックスタート](docs/QUICKSTART.md) - 初めての方向け
- [❓ FAQ](docs/FAQ.md) - よくある質問
- [📊 API仕様](docs/API.md) - APIリファレンス

---

## 🤝 貢献

個人利用プロジェクトですが、改善提案は歓迎します。

---

## 📄 ライセンス

MIT License

---

## 📞 サポート

個人プロジェクトのため、公式サポートはありません。
GitHubのIssuesで質問・バグ報告を受け付けています。

---

**AGStock - あなた専用のAI投資アシスタント** 🚀📈
