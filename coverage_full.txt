============================= test session starts =============================
platform win32 -- Python 3.11.0, pytest-7.4.2, pluggy-1.6.0
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: C:\gemini-desktop\AGStock
configfile: pytest.ini
plugins: anyio-4.9.0, dash-3.1.1, Faker-37.5.3, logfire-4.0.0, asyncio-0.23.7, benchmark-5.1.0, cov-4.1.0, mock-3.14.1, timeout-2.4.0, xdist-3.8.0, requests-mock-1.12.1, respx-0.22.0, typeguard-4.4.4
asyncio: mode=Mode.STRICT
collected 621 items

tests\test_advanced_features.py ..                                       [  0%]
tests\test_advanced_models.py ..                                         [  0%]
tests\test_advanced_orders.py ....                                       [  1%]
tests\test_agents.py .......                                             [  2%]
tests\test_async_data_loader.py ........                                 [  3%]
tests\test_auth.py .........                                             [  5%]
tests\test_auto_rebalancer_comprehensive.py ......                       [  6%]
tests\test_auto_trader_assets.py .                                       [  6%]
tests\test_auto_trader_ui.py ...                                         [  6%]
tests\test_backtester.py ..FF..FFFFFFFF.F                                [  9%]
tests\test_backtester_comprehensive.py ...........                       [ 11%]
tests\test_backtester_risk.py .                                          [ 11%]
tests\test_backtester_short.py ..                                        [ 11%]
tests\test_backup_manager.py ....F.....                                  [ 13%]
tests\test_broker.py ......                                              [ 14%]
tests\test_cache_config.py FF                                            [ 14%]
tests\test_config.py ............                                        [ 16%]
tests\test_config_manager.py ............                                [ 18%]
tests\test_constants.py ................                                 [ 20%]
tests\test_core_enhancements.py ....                                     [ 21%]
tests\test_cost_optimizer.py .......                                     [ 22%]
tests\test_cross_validation.py ..                                        [ 23%]
tests\test_dashboard_utils.py ......                                     [ 23%]
tests\test_data_loader.py .F...............                              [ 26%]
tests\test_data_loader_comprehensive.py ....F.......                     [ 28%]
tests\test_data_manager.py ............                                  [ 30%]
tests\test_db_maintenance_comprehensive.py ........                      [ 31%]
tests\test_dl_strategy.py .                                              [ 32%]
tests\test_dynamic_ensemble.py ....                                      [ 32%]
tests\test_dynamic_stop.py ...............                               [ 35%]
tests\test_execution.py ...................                              [ 38%]
tests\test_execution_real.py ...                                         [ 38%]
tests\test_features_comprehensive.py ..........                          [ 40%]
tests\test_formatters.py ......................................          [ 46%]
tests\test_fully_automated_trader.py FF.......                           [ 47%]
tests\test_fundamentals.py ....................                          [ 51%]
tests\test_hierarchical_strategy.py ...............                      [ 53%]
tests\test_kelly_criterion.py ................                           [ 56%]
tests\test_lightgbm.py F                                                 [ 56%]
tests\test_live_trading.py .....                                         [ 57%]
tests\test_llm_analyzer.py ...                                           [ 57%]
tests\test_logging_config.py ....F....                                   [ 58%]
tests\test_meta_learner.py F                                             [ 59%]
tests\test_ml_pipeline.py ......                                         [ 60%]
tests\test_ml_strategy.py ...                                            [ 60%]
tests\test_morning_brief.py ...FF.                                       [ 61%]
tests\test_multi_timeframe.py ..F...........FF                           [ 64%]
tests\test_notifier_comprehensive.py .....                               [ 64%]
tests\test_optimization.py ....                                          [ 65%]
tests\test_optimization_transformer.py .                                 [ 65%]
tests\test_optimizer.py FF                                               [ 66%]
tests\test_optimizer_new.py ...........                                  [ 67%]
tests\test_paper_trade.py ......                                         [ 68%]
tests\test_performance.py ..                                             [ 69%]
tests\test_phase29_integration.py ....                                   [ 69%]
tests\test_phase30_1_integration.py ....                                 [ 70%]
tests\test_phase30_2_mtf.py .                                            [ 70%]
tests\test_phase30_3_risk.py .                                           [ 70%]
tests\test_phase30_full_integration.py F.                                [ 71%]
tests\test_phase35_crypto.py FF..                                        [ 71%]
tests\test_portfolio.py ..                                               [ 71%]
tests\test_portfolio_manager.py ................                         [ 74%]
tests\test_portfolio_optimization.py .                                   [ 74%]
tests\test_portfolio_optimizer.py FFFFFF.....                            [ 76%]
tests\test_pytest_cov_optional.py ..                                     [ 76%]
tests\test_rakuten_broker.py ....                                        [ 77%]
tests\test_regime.py ......                                              [ 78%]
tests\test_regime_detector.py ......................                     [ 81%]
tests\test_risk_guard.py .......                                         [ 83%]
tests\test_risk_limiter.py ..........                                    [ 84%]
tests\test_sector_rotation.py .......                                    [ 85%]
tests\test_sentiment.py .......                                          [ 86%]
tests\test_small_modules.py .........s.                                  [ 88%]
tests\test_smart_notifier.py FFFFFF..F                                   [ 90%]
tests\test_smart_notifier_comprehensive.py ........                      [ 91%]
tests\test_strategies.py ...............                                 [ 93%]
tests\test_strategies_base.py ......F.                                   [ 95%]
tests\test_strategies_legacy_coverage.py ......                          [ 96%]
tests\test_transformer_model.py ....F....FF.                             [ 98%]
tests\test_ui_renderers.py .....                                         [ 98%]
tests\test_visualizer.py .......                                         [100%]

================================== FAILURES ===================================
____________________ TestBacktester.test_run_returns_dict _____________________
tests\test_backtester.py:22: in test_run_returns_dict
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
____________ TestBacktester.test_run_result_contains_required_keys ____________
tests\test_backtester.py:27: in test_run_result_contains_required_keys
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
_________________ TestBacktester.test_total_return_is_numeric _________________
tests\test_backtester.py:45: in test_total_return_is_numeric
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
_________________ TestBacktester.test_final_value_calculation _________________
tests\test_backtester.py:50: in test_final_value_calculation
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
_______________ TestBacktester.test_signals_length_matches_data _______________
tests\test_backtester.py:57: in test_signals_length_matches_data
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
______________ TestBacktester.test_positions_length_matches_data ______________
tests\test_backtester.py:62: in test_positions_length_matches_data
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
__________________ TestBacktester.test_positions_are_binary ___________________
tests\test_backtester.py:67: in test_positions_are_binary
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
_________________ TestBacktester.test_equity_curve_is_series __________________
tests\test_backtester.py:73: in test_equity_curve_is_series
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
_______________ TestBacktester.test_equity_curve_starts_at_one ________________
tests\test_backtester.py:78: in test_equity_curve_starts_at_one
    result = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
__________________ TestBacktester.test_buy_and_hold_strategy __________________
tests\test_backtester.py:104: in test_buy_and_hold_strategy
    result = backtester.run(df, strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
______________ TestBacktester.test_multiple_strategies_same_data ______________
tests\test_backtester.py:137: in test_multiple_strategies_same_data
    result1 = backtester.run(sample_stock_data, sma_strategy)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'SMACrossoverStrategy' object has no attribute 'get'
_____________________ TestBackupManager.test_list_backups _____________________
tests\test_backup_manager.py:92: in test_list_backups
    assert len(backups) == 2
E   AssertionError: assert 1 == 2
E    +  where 1 = len([{'created': datetime.datetime(2025, 12, 4, 17, 59, 57, 320892), 'filename': 'paper_trading_20251204_175957.db', 'path': 'C:\\Users\\neoen\\AppData\\Local\\Temp\\tmpf0qdhnst\\paper_trading_20251204_175957.db', 'size_mb': 0.0078125}])
---------------------------- Captured stderr call -----------------------------
2025-12-04 17:59:57,326 - src.backup_manager - INFO - Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpf0qdhnst\paper_trading_20251204_175957.db
2025-12-04 17:59:57,430 - src.backup_manager - INFO - Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpf0qdhnst\paper_trading_20251204_175957.db
------------------------------ Captured log call ------------------------------
INFO     src.backup_manager:backup_manager.py:63 Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpf0qdhnst\paper_trading_20251204_175957.db
INFO     src.backup_manager:backup_manager.py:63 Backup created successfully: C:\Users\neoen\AppData\Local\Temp\tmpf0qdhnst\paper_trading_20251204_175957.db
_________________________ test_install_cache_success __________________________
tests\test_cache_config.py:11: in test_install_cache_success
    with patch('src.cache_config.requests_cache') as mock_requests_cache:
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1427: in __enter__
    original, local = self.get_original()
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1400: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.cache_config' from 'C:\\gemini-desktop\\AGStock\\src\\cache_config.py'> does not have the attribute 'requests_cache'
_______________________ test_install_cache_import_error _______________________
tests\test_cache_config.py:26: in test_install_cache_import_error
    with patch('src.cache_config.requests_cache', side_effect=ImportError):
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1427: in __enter__
    original, local = self.get_original()
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1400: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.cache_config' from 'C:\\gemini-desktop\\AGStock\\src\\cache_config.py'> does not have the attribute 'requests_cache'
_______________ TestFetchStockData.test_fetch_multiple_tickers ________________
tests\test_data_loader.py:94: in test_fetch_multiple_tickers
    assert '7203.T' in result
E   AssertionError: assert '7203.T' in {}
---------------------------- Captured stdout call -----------------------------
9984.T: No data found for this date range, symbol may be delisted7203.T: No data found for this date range, symbol may be delisted

---------------------------- Captured stderr call -----------------------------
2025-12-04 18:00:02,249 - src.async_data_loader - WARNING - Empty DataFrame for 9984.T
2025-12-04 18:00:02,250 - src.async_data_loader - WARNING - Empty DataFrame for 7203.T
2025-12-04 18:00:02,252 - src.async_data_loader - INFO - Successfully fetched 0/2 tickers
------------------------------ Captured log call ------------------------------
WARNING  src.async_data_loader:async_data_loader.py:110 Empty DataFrame for 9984.T
WARNING  src.async_data_loader:async_data_loader.py:110 Empty DataFrame for 7203.T
INFO     src.async_data_loader:async_data_loader.py:192 Successfully fetched 0/2 tickers
______________________________ test_parse_period ______________________________
tests\test_data_loader_comprehensive.py:103: in test_parse_period
    d_invalid = parse_period('invalid')
src\data_loader.py:88: in parse_period
    days = int(period[:-1])
E   ValueError: invalid literal for int() with base 10: 'invali'
________________ TestFullyAutomatedTrader.test_initialization _________________
tests\test_fully_automated_trader.py:55: in test_initialization
    assert trader.target_japan_pct == 60.0
E   assert 40 == 60.0
E    +  where 40 = <fully_automated_trader.FullyAutomatedTrader object at 0x000002020D9EB310>.target_japan_pct
---------------------------- Captured stdout setup ----------------------------
[2025-12-04 18:00:03] [INFO] Phase 30-1 & 30-3: リアルタイム適応学習・高度リスク管理モジュール初期化完了
[2025-12-04 18:00:03] [INFO] フル自動トレーダー初期化完了
---------------------------- Captured stderr setup ----------------------------
2025-12-04 18:00:03,091 - src.regime_detector - INFO - MarketRegimeDetector initialized
2025-12-04 18:00:03,091 - src.dynamic_risk_manager - INFO - DynamicRiskManager initialized
----------------------------- Captured log setup ------------------------------
INFO     src.regime_detector:regime_detector.py:35 MarketRegimeDetector initialized
INFO     src.dynamic_risk_manager:dynamic_risk_manager.py:34 DynamicRiskManager initialized
______________ TestFullyAutomatedTrader.test_calculate_daily_pnl ______________
tests\test_fully_automated_trader.py:70: in test_calculate_daily_pnl
    assert pnl == 1000  # 今日の取引のみ
E   assert 0.0 == 1000
---------------------------- Captured stdout setup ----------------------------
[2025-12-04 18:00:03] [INFO] Phase 30-1 & 30-3: リアルタイム適応学習・高度リスク管理モジュール初期化完了
[2025-12-04 18:00:03] [INFO] フル自動トレーダー初期化完了
---------------------------- Captured stderr setup ----------------------------
2025-12-04 18:00:03,110 - src.regime_detector - INFO - MarketRegimeDetector initialized
2025-12-04 18:00:03,111 - src.dynamic_risk_manager - INFO - DynamicRiskManager initialized
----------------------------- Captured log setup ------------------------------
INFO     src.regime_detector:regime_detector.py:35 MarketRegimeDetector initialized
INFO     src.dynamic_risk_manager:dynamic_risk_manager.py:34 DynamicRiskManager initialized
_________________ TestLightGBMStrategy.test_generate_signals __________________
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1356: in patched
    with self.decoration_helper(patched,
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\contextlib.py:137: in __enter__
    return next(self.gen)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1338: in decoration_helper
    arg = exit_stack.enter_context(patching)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\contextlib.py:502: in enter_context
    result = _enter(cm)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1427: in __enter__
    original, local = self.get_original()
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1400: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.strategies' from 'C:\\gemini-desktop\\AGStock\\src\\strategies\\__init__.py'> does not have the attribute 'fetch_macro_data'
____________________ test_setup_logging_creates_directory _____________________
tests\test_logging_config.py:107: in test_setup_logging_creates_directory
    setup_logging(log_dir=str(log_dir))
src\logging_config.py:57: in setup_logging
    file_handler = logging.handlers.RotatingFileHandler(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\handlers.py:155: in __init__
    BaseRotatingHandler.__init__(self, filename, mode, encoding=encoding,
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\handlers.py:58: in __init__
    logging.FileHandler.__init__(self, filename, mode=mode,
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\__init__.py:1181: in __init__
    StreamHandler.__init__(self, self._open())
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\logging\__init__.py:1213: in _open
    return open_func(self.baseFilename, self.mode,
E   FileNotFoundError: [Errno 2] No such file or directory: 'C:\\Users\\neoen\\AppData\\Local\\Temp\\pytest-of-neoen\\pytest-242\\test_setup_logging_creates_dir0\\test_logs\\agstock.log'
___________________________ test_meta_learner_flow ____________________________
tests\test_meta_learner.py:50: in test_meta_learner_flow
    learner = MetaLearner(model_path="models/test_meta.txt")
E   TypeError: MetaLearner.__init__() got an unexpected keyword argument 'model_path'
_________________ TestMorningBrief.test_get_trading_strategy __________________
tests\test_morning_brief.py:60: in test_get_trading_strategy
    strategy = morning_brief.get_trading_strategy()
E   AttributeError: 'MorningBrief' object has no attribute 'get_trading_strategy'
____________________ TestMorningBrief.test_generate_brief _____________________
tests\test_morning_brief.py:70: in test_generate_brief
    with patch.object(morning_brief, 'get_trading_strategy', return_value="買い優勢"):
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1427: in __enter__
    original, local = self.get_original()
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1400: in get_original
    raise AttributeError(
E   AttributeError: <morning_brief.MorningBrief object at 0x000002020DA7DB50> does not have the attribute 'get_trading_strategy'
_________________________ test_resample_data_monthly __________________________
pandas\_libs\tslibs\offsets.pyx:4089: in pandas._libs.tslibs.offsets._get_offset
    ???
E   KeyError: 'ME'

The above exception was the direct cause of the following exception:
pandas\_libs\tslibs\offsets.pyx:4190: in pandas._libs.tslibs.offsets.to_offset
    ???
pandas\_libs\tslibs\offsets.pyx:4095: in pandas._libs.tslibs.offsets._get_offset
    ???
E   ValueError: Invalid frequency: ME

The above exception was the direct cause of the following exception:
tests\test_multi_timeframe.py:56: in test_resample_data_monthly
    monthly = analyzer.resample_data(daily_data, 'ME')
src\multi_timeframe.py:51: in resample_data
    resampled = df.resample(rule).agg(agg_dict)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\frame.py:10994: in resample
    return super().resample(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\generic.py:8888: in resample
    return get_resampler(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\resample.py:1522: in get_resampler
    tg = TimeGrouper(**kwds)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\resample.py:1599: in __init__
    freq = to_offset(freq)
pandas\_libs\tslibs\offsets.pyx:4102: in pandas._libs.tslibs.offsets.to_offset
    ???
pandas\_libs\tslibs\offsets.pyx:4198: in pandas._libs.tslibs.offsets.to_offset
    ???
E   ValueError: Invalid frequency: ME
____________________________ test_add_mtf_features ____________________________
pandas\_libs\tslibs\offsets.pyx:4089: in pandas._libs.tslibs.offsets._get_offset
    ???
E   KeyError: 'ME'

The above exception was the direct cause of the following exception:
pandas\_libs\tslibs\offsets.pyx:4190: in pandas._libs.tslibs.offsets.to_offset
    ???
pandas\_libs\tslibs\offsets.pyx:4095: in pandas._libs.tslibs.offsets._get_offset
    ???
E   ValueError: Invalid frequency: ME

The above exception was the direct cause of the following exception:
tests\test_multi_timeframe.py:191: in test_add_mtf_features
    result = analyzer.add_mtf_features(daily_data)
src\multi_timeframe.py:139: in add_mtf_features
    monthly_df = self.resample_data(df, 'ME')
src\multi_timeframe.py:51: in resample_data
    resampled = df.resample(rule).agg(agg_dict)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\frame.py:10994: in resample
    return super().resample(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\generic.py:8888: in resample
    return get_resampler(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\resample.py:1522: in get_resampler
    tg = TimeGrouper(**kwds)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\resample.py:1599: in __init__
    freq = to_offset(freq)
pandas\_libs\tslibs\offsets.pyx:4102: in pandas._libs.tslibs.offsets.to_offset
    ???
pandas\_libs\tslibs\offsets.pyx:4198: in pandas._libs.tslibs.offsets.to_offset
    ???
E   ValueError: Invalid frequency: ME
______________________ test_add_mtf_features_integration ______________________
pandas\_libs\tslibs\offsets.pyx:4089: in pandas._libs.tslibs.offsets._get_offset
    ???
E   KeyError: 'ME'

The above exception was the direct cause of the following exception:
pandas\_libs\tslibs\offsets.pyx:4190: in pandas._libs.tslibs.offsets.to_offset
    ???
pandas\_libs\tslibs\offsets.pyx:4095: in pandas._libs.tslibs.offsets._get_offset
    ???
E   ValueError: Invalid frequency: ME

The above exception was the direct cause of the following exception:
tests\test_multi_timeframe.py:219: in test_add_mtf_features_integration
    result = analyzer.add_mtf_features(df)
src\multi_timeframe.py:139: in add_mtf_features
    monthly_df = self.resample_data(df, 'ME')
src\multi_timeframe.py:51: in resample_data
    resampled = df.resample(rule).agg(agg_dict)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\frame.py:10994: in resample
    return super().resample(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\generic.py:8888: in resample
    return get_resampler(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\resample.py:1522: in get_resampler
    tg = TimeGrouper(**kwds)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\resample.py:1599: in __init__
    freq = to_offset(freq)
pandas\_libs\tslibs\offsets.pyx:4102: in pandas._libs.tslibs.offsets.to_offset
    ???
pandas\_libs\tslibs\offsets.pyx:4198: in pandas._libs.tslibs.offsets.to_offset
    ???
E   ValueError: Invalid frequency: ME
____________________ TestOptimizer.test_optimize_combined _____________________
tests\test_optimizer.py:38: in test_optimize_combined
    params, value = optimizer.optimize(n_trials=2)
src\optimizer.py:72: in optimize
    study.optimize(self.objective, n_trials=n_trials)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\study.py:442: in optimize
    _optimize(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:66: in _optimize
    _optimize_sequential(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:163: in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:251: in _run_trial
    raise func_err
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:200: in _run_trial
    value_or_values = func(trial)
src\optimizer.py:58: in objective
    res = self.backtester.run(train_df, strategy, stop_loss=stop_loss, take_profit=take_profit)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'CombinedStrategy' object has no attribute 'get'
---------------------------- Captured stderr call -----------------------------
[W 2025-12-04 18:00:12,676] Trial 0 failed with parameters: {'rsi_period': 30, 'bb_length': 27, 'bb_std': 2.2, 'trend_period': 127, 'stop_loss': 0.02, 'take_profit': 0.21000000000000002} because of the following error: AttributeError("'CombinedStrategy' object has no attribute 'get'").
Traceback (most recent call last):
  File "C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
                      ^^^^^^^^^^^
  File "C:\gemini-desktop\AGStock\src\optimizer.py", line 58, in objective
    res = self.backtester.run(train_df, strategy, stop_loss=stop_loss, take_profit=take_profit)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\gemini-desktop\AGStock\src\backtester.py", line 90, in run
    strat = strategy_map.get(ticker)
            ^^^^^^^^^^^^^^^^
AttributeError: 'CombinedStrategy' object has no attribute 'get'
[W 2025-12-04 18:00:12,677] Trial 0 failed with value None.
_______________________ TestOptimizer.test_optimize_rsi _______________________
tests\test_optimizer.py:31: in test_optimize_rsi
    params, value = optimizer.optimize(n_trials=2)
src\optimizer.py:72: in optimize
    study.optimize(self.objective, n_trials=n_trials)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\study.py:442: in optimize
    _optimize(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:66: in _optimize
    _optimize_sequential(
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:163: in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:251: in _run_trial
    raise func_err
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py:200: in _run_trial
    value_or_values = func(trial)
src\optimizer.py:58: in objective
    res = self.backtester.run(train_df, strategy, stop_loss=stop_loss, take_profit=take_profit)
src\backtester.py:90: in run
    strat = strategy_map.get(ticker)
E   AttributeError: 'RSIStrategy' object has no attribute 'get'
---------------------------- Captured stderr call -----------------------------
[W 2025-12-04 18:00:12,736] Trial 0 failed with parameters: {'period': 7, 'lower': 34, 'upper': 62, 'trend_period': 181, 'stop_loss': 0.06, 'take_profit': 0.060000000000000005} because of the following error: AttributeError("'RSIStrategy' object has no attribute 'get'").
Traceback (most recent call last):
  File "C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\optuna\study\_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
                      ^^^^^^^^^^^
  File "C:\gemini-desktop\AGStock\src\optimizer.py", line 58, in objective
    res = self.backtester.run(train_df, strategy, stop_loss=stop_loss, take_profit=take_profit)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\gemini-desktop\AGStock\src\backtester.py", line 90, in run
    strat = strategy_map.get(ticker)
            ^^^^^^^^^^^^^^^^
AttributeError: 'RSIStrategy' object has no attribute 'get'
[W 2025-12-04 18:00:12,738] Trial 0 failed with value None.
_____________ TestPhase30FullIntegration.test_dynamic_stop_update _____________
tests\test_phase30_full_integration.py:143: in test_dynamic_stop_update
    self.assertEqual(pos['highest_price'], 1100.0)
E   AssertionError: 1000.0 != 1100.0
---------------------------- Captured stdout call -----------------------------
[2025-12-04 18:00:15] [INFO] Phase 30-1 & 30-3: \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u9069\u5fdc\u5b66\u7fd2\u30fb\u9ad8\u5ea6\u30ea\u30b9\u30af\u7ba1\u7406\u30e2\u30b8\u30e5\u30fc\u30eb\u521d\u671f\u5316\u5b8c\u4e86\n[2025-12-04 18:00:15] [INFO] \u30d5\u30eb\u81ea\u52d5\u30c8\u30ec\u30fc\u30c0\u30fc\u521d\u671f\u5316\u5b8c\u4e86\n\nTesting Dynamic Stop Update...\n\u2705 BUY Executed: 7203.T x 100 @ 1000.0\nUpdated Position after rise: Stop=0.0, High=1000.0
__________________________ test_crypto_data_loading ___________________________
tests\test_phase35_crypto.py:14: in test_crypto_data_loading
    assert "BTC-USD" in data_map
E   AssertionError: assert 'BTC-USD' in {}
---------------------------- Captured stdout call -----------------------------

[*********************100%***********************]  1 of 1 completed

1 Failed download:
- BTC-USD: No data found for this date range, symbol may be delisted
____________________________ test_fx_data_loading _____________________________
tests\test_phase35_crypto.py:27: in test_fx_data_loading
    assert "USDJPY=X" in data_map
E   AssertionError: assert 'USDJPY=X' in {}
---------------------------- Captured stdout call -----------------------------

[*********************100%***********************]  1 of 1 completed

1 Failed download:
- USDJPY=X: No data found for this date range, symbol may be delisted
____________ TestPortfolioOptimizer.test_optimizer_initialization _____________
tests\test_portfolio_optimizer.py:40: in test_optimizer_initialization
    assert optimizer.returns is not None
E   AttributeError: 'PortfolioOptimizer' object has no attribute 'returns'
___________ TestPortfolioOptimizer.test_calculate_portfolio_metrics ___________
tests\test_portfolio_optimizer.py:48: in test_calculate_portfolio_metrics
    metrics = optimizer.calculate_portfolio_metrics(weights)
E   AttributeError: 'PortfolioOptimizer' object has no attribute 'calculate_portfolio_metrics'
_____________ TestPortfolioOptimizer.test_find_efficient_frontier _____________
tests\test_portfolio_optimizer.py:62: in test_find_efficient_frontier
    frontier = optimizer.find_efficient_frontier(num_points=10)
E   AttributeError: 'PortfolioOptimizer' object has no attribute 'find_efficient_frontier'
______________ TestPortfolioOptimizer.test_maximize_sharpe_ratio ______________
tests\test_portfolio_optimizer.py:78: in test_maximize_sharpe_ratio
    optimal_weights = optimizer.maximize_sharpe_ratio()
E   AttributeError: 'PortfolioOptimizer' object has no attribute 'maximize_sharpe_ratio'
________________ TestPortfolioOptimizer.test_minimize_variance ________________
tests\test_portfolio_optimizer.py:90: in test_minimize_variance
    min_var_weights = optimizer.minimize_variance()
E   AttributeError: 'PortfolioOptimizer' object has no attribute 'minimize_variance'
___________________ TestPortfolioOptimizer.test_risk_parity ___________________
tests\test_portfolio_optimizer.py:99: in test_risk_parity
    rp_weights = optimizer.risk_parity()
E   TypeError: PortfolioOptimizer.risk_parity() missing 1 required positional argument: 'returns'
____________________ TestSmartNotifier.test_initialization ____________________
tests\test_smart_notifier.py:46: in test_initialization
    assert notifier.min_confidence == 0.7
E   AttributeError: 'SmartNotifier' object has no attribute 'min_confidence'
_____________ TestSmartNotifier.test_filter_signals_by_confidence _____________
tests\test_smart_notifier.py:56: in test_filter_signals_by_confidence
    filtered = notifier.filter_signals(signals)
E   AttributeError: 'SmartNotifier' object has no attribute 'filter_signals'
__________ TestSmartNotifier.test_filter_signals_by_expected_return ___________
tests\test_smart_notifier.py:68: in test_filter_signals_by_expected_return
    filtered = notifier.filter_signals(signals)
E   AttributeError: 'SmartNotifier' object has no attribute 'filter_signals'
_________________ TestSmartNotifier.test_filter_signals_empty _________________
tests\test_smart_notifier.py:76: in test_filter_signals_empty
    filtered = notifier.filter_signals(signals)
E   AttributeError: 'SmartNotifier' object has no attribute 'filter_signals'
____________________ TestSmartNotifier.test_generate_chart ____________________
tests\test_smart_notifier.py:89: in test_generate_chart
    chart_path = notifier.generate_chart("TEST", period="30d")
E   AttributeError: 'SmartNotifier' object has no attribute 'generate_chart'
____________________ TestSmartNotifier.test_is_quiet_hours ____________________
tests\test_smart_notifier.py:101: in test_is_quiet_hours
    with patch('src.smart_notifier.datetime') as mock_datetime:
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1427: in __enter__
    original, local = self.get_original()
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:1400: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.smart_notifier' from 'C:\\gemini-desktop\\AGStock\\src\\smart_notifier.py'> does not have the attribute 'datetime'
________________ TestSmartNotifier.test_format_signal_message _________________
tests\test_smart_notifier.py:145: in test_format_signal_message
    message = notifier.format_signal_message(signal)
E   AttributeError: 'SmartNotifier' object has no attribute 'format_signal_message'
_____________________________ test_analyze_empty ______________________________
tests\test_strategies_base.py:106: in test_analyze_empty
    result = strategy.analyze(pd.DataFrame())
src\strategies\base.py:104: in analyze
    signals = self.generate_signals(df)
tests\test_strategies_base.py:16: in generate_signals
    signals[df['Close'] > df['Open']] = 1
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\frame.py:3761: in __getitem__
    indexer = self.columns.get_loc(key)
C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\indexes\range.py:349: in get_loc
    raise KeyError(key)
E   KeyError: 'Close'
____________ TestTemporalFusionTransformer.test_attention_weights _____________
tests\test_transformer_model.py:132: in test_attention_weights
    assert np.abs(attention_weights.sum() - X.shape[1]) < 1e-5
E   AssertionError: assert 30131114.0 < 1e-05
E    +  where 30131114.0 = <ufunc 'absolute'>((30131144.0 - 30))
E    +    where <ufunc 'absolute'> = np.abs
E    +    and   30131144.0 = <built-in method sum of numpy.ndarray object at 0x0000020231F18450>()
E    +      where <built-in method sum of numpy.ndarray object at 0x0000020231F18450> = array([[ 989868.75, 1563518.6 , 1711438.8 ,  383415.12, 1844666.5 ,\n         707430.6 ,  807384.5 , 1654751.8 , 140965....4 ,  336093.4 ,  798286.44,\n        1286048.8 , 1296825.2 ,  970614.06, 1002754.44,  461147.12]],\n      dtype=float32).sum
___________ TestTransformerStrategy.test_strategy_confidence_score ____________
tests\test_transformer_model.py:233: in test_strategy_confidence_score
    confidence = strategy.get_confidence()
E   AttributeError: 'TransformerStrategy' object has no attribute 'get_confidence'
---------------------------- Captured stderr call -----------------------------
2025-12-04 18:00:45,138 - src.strategies_legacy - ERROR - Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
2025-12-04 18:00:45,138 - src.strategies_legacy - ERROR - Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
2025-12-04 18:00:45,138 - src.strategies_legacy - ERROR - Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
------------------------------ Captured log call ------------------------------
ERROR    src.strategies_legacy:strategies_legacy.py:698 Error training GRU: 'TransformerStrategy' object has no attribute 'sequence_length'
__________ TestTransformerIntegration.test_ensemble_with_transformer __________
tests\test_transformer_model.py:247: in test_ensemble_with_transformer
    ensemble = CombinedStrategy(
E   TypeError: CombinedStrategy.__init__() got an unexpected keyword argument 'strategies'
============================== warnings summary ===============================
..\..\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\tensorflow\lite\python\util.py:51
..\..\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\tensorflow\lite\python\util.py:51
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\tensorflow\lite\python\util.py:51: DeprecationWarning: jax.xla_computation is deprecated. Please use the AOT APIs.
    from jax import xla_computation as _xla_computation

..\..\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\streamlit\elements\image.py:22
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\streamlit\elements\image.py:22: DeprecationWarning: 'imghdr' is deprecated and slated for removal in Python 3.13
    import imghdr

tests/test_phase29_integration.py::test_advanced_features
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_advanced_features returned False, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase29_integration.py::test_stacking_ensemble
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_stacking_ensemble returned False, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase29_integration.py::test_hyperparameter_tuning
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_hyperparameter_tuning returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase29_integration.py::test_performance_monitor
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase29_integration.py::test_performance_monitor returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_online_learning
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_online_learning returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_regime_detector
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_regime_detector returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_dynamic_risk_manager
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_dynamic_risk_manager returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_phase30_1_integration.py::test_integration
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/test_phase30_1_integration.py::test_integration returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_pytest_cov_optional.py::test_registers_cov_options_when_plugin_missing
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\dash\testing\plugin.py:104: PytestDeprecationWarning: The hookimpl pytest_addhooks uses old-style configuration options (marks or attributes).
  Please use the pytest.hookimpl(tryfirst=True) decorator instead
   to configure the hooks.
   See https://docs.pytest.org/en/latest/deprecations.html#configuring-hook-specs-impls-using-markers
    @pytest.mark.tryfirst

tests/test_pytest_cov_optional.py::test_registers_cov_options_when_plugin_missing
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\_pytest\config\__init__.py:331: PluggyTeardownRaisedWarning: A plugin raised an exception during an old-style hookwrapper teardown.
  Plugin: helpconfig, Hook: pytest_cmdline_parse
  ArgumentError: argument --cov: conflicting option string: --cov
  For more information see https://pluggy.readthedocs.io/en/stable/api_reference.html#pluggy.PluggyTeardownRaisedWarning
    config = pluginmanager.hook.pytest_cmdline_parse(

tests/test_transformer_model.py::TestTemporalFusionTransformer::test_model_save_and_load
  C:\Users\neoen\AppData\Local\Programs\Python\Python311\Lib\site-packages\keras\src\engine\training.py:3103: UserWarning: You are saving your model as an HDF5 file via `model.save()`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')`.
    saving_api.save_model(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.0-final-0 -----------
Name                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------
src\advanced_backtest.py                   101    101     0%   6-282
src\advanced_features.py                   124     11    91%   39, 74, 107, 150, 174-175, 225, 273, 311-312, 332
src\advanced_models.py                      41      4    90%   35-41
src\advanced_risk.py                        89     89     0%   6-234
src\agents.py                              173     43    75%   24, 33, 59-69, 81, 91, 93, 110-115, 121-127, 131-137, 142-143, 145-146, 157, 181-188, 249
src\ai_analyst.py                           46     46     0%   5-97
src\alert_manager.py                       126    126     0%   5-270
src\alert_system.py                        125    125     0%   9-344
src\anomaly_detector.py                     90     90     0%   5-208
src\async_data_loader.py                   143     61    57%   57-63, 79, 82-96, 106-107, 114-127, 186-187, 190, 219-220, 226-229, 249-255, 260-265, 310-328
src\auth.py                                152     25    84%   87, 90, 93, 139, 235-238, 249-250, 287-291, 297-317
src\auto_rebalancer.py                     132     31    77%   50-51, 73-75, 109-110, 125-126, 142, 154-158, 173-174, 185, 196-198, 256-260, 272-278
src\auto_trader_ui.py                      107     74    31%   12-27, 30-36, 39-40, 43-56, 60-129, 144
src\backtest_engine.py                      45     41     9%   5-86
src\backtest_visualizer.py                  81     81     0%   6-314
src\backtester.py                          232     21    91%   83, 89, 94, 254, 272-274, 285-287, 300, 304-322
src\backup_manager.py                      115     31    73%   70-78, 104-106, 128, 144-145, 161, 177-178, 205-206, 220-222, 239-254
src\base.py                                120     51    58%   46-48, 53, 57-61, 68-70, 75, 79-83, 90-91, 96, 101, 105-113, 122, 127, 132, 137, 146, 151, 156, 161, 173-176, 180-186, 190-192
src\benchmark_comparator.py                 99     99     0%   6-269
src\bert_sentiment.py                       72     27    62%   39-42, 55, 98-100, 104-128
src\broker.py                               42      7    83%   40, 45, 50, 55, 60, 65, 70
src\cache_config.py                          8      6    25%   9-20
src\cloud_storage.py                        79     37    53%   23-32, 40, 48, 55-57, 68-69, 80-82, 86-92, 96-106
src\config.py                               46      0   100%
src\config_manager.py                       47      4    91%   89-93
src\constants.py                            10      0   100%
src\copy_trading.py                        149    149     0%   5-382
src\cost_optimizer.py                      125     62    50%   56, 78-80, 157, 161, 184, 199, 216-228, 272-281, 286-343, 347
src\cross_validation.py                     43      1    98%   143
src\dashboard_utils.py                      36      1    97%   40
src\data_loader.py                         120     15    88%   33-35, 62-64, 69, 91, 113-115, 119-120, 139-140
src\data_manager.py                         84     10    88%   63, 111-112, 142-144, 162-163, 173-174
src\db_maintenance.py                       86     18    79%   84-85, 97-99, 126-128, 132-144
src\design_tokens.py                        52      0   100%
src\dividend_strategy.py                    71     71     0%   6-236
src\dynamic_ensemble.py                     77     16    79%   56, 65, 99-100, 127-129, 142-143, 148-154
src\dynamic_risk_manager.py                 89     31    65%   108-110, 150-153, 175, 198, 218-232, 241, 260, 266-299
src\dynamic_risk_manager_refactored.py     121    121     0%   6-337
src\dynamic_stop.py                         52      2    96%   67-68
src\encryption.py                           74     74     0%   5-188
src\enhanced_performance_dashboard.py      144    144     0%   5-323
src\ensemble.py                             27     22    19%   14-15, 27-65
src\error_handler.py                       109    109     0%   6-215
src\error_handling.py                       88     88     0%   8-301
src\execution.py                            78      0   100%
src\execution_optimizer.py                  69     69     0%   6-213
src\export_manager.py                       80     80     0%   5-175
src\factor_analyzer.py                      85     85     0%   6-269
src\features.py                            122     11    91%   60, 100, 105, 137-139, 146-147, 219, 225, 232
src\formatters.py                           83      2    98%   123-124
src\fundamentals.py                         26      2    92%   34, 48
src\hierarchical_strategy.py                42     19    55%   33-78
src\hyperparameter_tuning.py               111     52    53%   158-172, 207-210, 235-238, 247-269, 281-287, 304-338, 342-349
src\ibkr_broker.py                          88     88     0%   1-154
src\integrated_signals.py                   69     69     0%   7-160
src\kelly_criterion.py                      35      1    97%   78
src\liquidity_analyzer.py                   74     74     0%   6-233
src\live_trading.py                        151     37    75%   47-48, 66, 70, 74, 100-103, 115, 126, 131-133, 177, 182-183, 188-189, 199-201, 207-208, 230-231, 239-244, 252-256, 259-260
src\llm_analyzer.py                         69     12    83%   12-15, 32-33, 84, 86, 89-91, 121
src\logging_config.py                       45      8    82%   93-102
src\macro_analyzer.py                       89     89     0%   6-208
src\meta_learner.py                        107     87    19%   65-69, 82-128, 145-193, 208-244, 249-264
src\metrics_collector.py                    87     87     0%   5-197
src\ml_pipeline.py                          89     20    78%   30-35, 42-43, 77-79, 86, 95-97, 105, 112, 119-121
src\monitoring_dashboard.py                 96     96     0%   5-174
src\mpt_optimizer.py                       102    102     0%   6-302
src\multi_timeframe.py                      77     27    65%   116, 118, 140-143, 154-182, 188-190
src\nisa_manager.py                        115    115     0%   5-342
src\notifier.py                             81      1    99%   22
src\online_learning.py                     113     59    48%   72, 83-85, 163-171, 180-193, 202-219, 228-241, 250-255, 272-286, 291-315
src\optimization.py                        204    150    26%   26-28, 51-81, 93-138, 177-260, 289-356, 381-430
src\optimizer.py                            47      0   100%
src\options_pricing.py                      89     89     0%   5-264
src\paper_trader.py                        144     42    71%   22-24, 60-66, 115, 144, 148-168, 204-207, 243, 274-294
src\parallel_backtester.py                  76     76     0%   5-228
src\patterns.py                             91     82    10%   10-24, 31-64, 70-106, 112-151, 157-181
src\pdf_report_generator.py                 94     94     0%   5-187
src\performance.py                         167    154     8%   19, 23, 32-91, 100-177, 186-241, 250-270, 283-320
src\performance_attribution.py              95     95     0%   5-232
src\performance_metrics.py                  97     97     0%   10-213
src\performance_monitor.py                 111    111     0%   10-314
src\performance_optimizer.py               113    113     0%   11-184
src\personal_features.py                   195    195     0%   6-345
src\portfolio.py                           131     74    44%   23, 46, 56, 72, 81, 87, 98, 126-142, 157-243
src\portfolio_manager.py                    42      2    95%   58-59
src\portfolio_manager_refactored.py        109    109     0%   6-263
src\portfolio_optimizer.py                 111     97    13%   37-84, 101-128, 153-205, 226-242, 246-269
src\production_manager.py                  101    101     0%   11-219
src\prompts.py                               3      0   100%
src\psychological_guard.py                  84     84     0%   6-294
src\pytest_cov_optional.py                  13      2    85%   14-15
src\rakuten_broker.py                      153     68    56%   43-49, 53-77, 82, 93-95, 116-118, 122-132, 137-138, 158-161, 166-167, 180-181, 203-204, 226-231, 235-238, 250-259
src\realtime_alerts.py                     129    129     0%   8-309
src\realtime_data.py                        96     96     0%   8-182
src\rebalancer.py                           84     38    55%   59, 124-126, 140, 172-179, 191-205, 210-246
src\recovery_manager.py                    107    107     0%   5-217
src\regime.py                              100     11    89%   62-63, 91-93, 103-105, 190-191, 196, 225, 230
src\regime_detector.py                     110     21    81%   103, 107-109, 129, 133, 174-176, 196, 200, 330-352
src\rich_notifier.py                       106    106     0%   5-291
src\risk_guard.py                          102      8    92%   41, 61-62, 76-77, 168, 172, 193
src\risk_limiter.py                        135     17    87%   191-221, 225
src\rl_agent.py                             74     74     0%   1-106
src\rl_environment.py                       65     65     0%   1-145
src\sector_rotation.py                      83      9    89%   47, 53-54, 77, 126, 144-145, 160, 173
src\sentiment.py                            74     11    85%   42-43, 61, 77, 79, 168-173
src\simple_dashboard.py                    113    113     0%   6-257
src\smart_notifier.py                       63      8    87%   51-52, 62-63, 69, 85-87
src\stacking_ensemble.py                   107     81    24%   71-97, 122-176, 188-197, 210-211, 220-231, 248-283, 287-293
src\strategies\__init__.py                   7      0   100%
src\strategies\base.py                      50      1    98%   106
src\strategies\custom\__init__.py            0      0   100%
src\strategies_legacy.py                   725    454    37%   15-20, 24-26, 71, 78-85, 91-95, 105, 135, 142, 158, 168, 188, 199, 222-224, 234, 275, 290-294, 311-312, 320, 341-358, 361-365, 380-384, 387-392, 396, 406-467, 470-474, 483-486, 489-491, 495-535, 548-615, 619-625, 629-658, 684-695, 704-725, 733-736, 742-798, 802-820, 827-830, 833-858, 861-885, 892-895, 898-922, 925-949, 958-970, 973-992, 1003, 1007-1016, 1040-1042, 1045-1095, 1098-1103, 1115-1116, 1119-1131, 1134-1138
src\strategy_marketplace.py                134    134     0%   5-381
src\streaming_pipeline.py                   84     84     0%   7-202
src\tax_calculator.py                       82     82     0%   5-280
src\tax_report_generator.py                 85     85     0%   5-268
src\trade_explainer.py                      32     32     0%   5-99
src\trader_profile.py                      123    123     0%   5-397
src\trading_performance_monitor.py          98     46    53%   168, 193-236, 251, 288-348, 352-360
src\transformer_model.py                   107     19    82%   19-20, 169, 239, 255, 272, 306-339
src\ui_advanced_analytics.py               157    157     0%   5-291
src\ui_ai_chat.py                           46     46     0%   4-76
src\ui_ai_report.py                         48     48     0%   4-80
src\ui_alerts.py                            79     79     0%   4-158
src\ui_automation.py                        77     77     0%   5-132
src\ui_components.py                       130    130     0%   5-327
src\ui_customizer.py                        82     82     0%   5-240
src\ui_export.py                            83     83     0%   4-162
src\ui_renderers.py                        560    495    12%   71-75, 102-118, 126-136, 152, 163-164, 171-198, 204-299, 306-802, 808-920, 931-970, 977-1044
src\ui_risk_dashboard.py                   118    118     0%   5-232
src\visualizer.py                           75      8    89%   23-24, 98-100, 155-157
src\xai.py                                  78     78     0%   8-227
----------------------------------------------------------------------
TOTAL                                    13053   8647    34%
Coverage HTML written to dir htmlcov

=========================== short test summary info ===========================
FAILED tests/test_backtester.py::TestBacktester::test_run_returns_dict - Attr...
FAILED tests/test_backtester.py::TestBacktester::test_run_result_contains_required_keys
FAILED tests/test_backtester.py::TestBacktester::test_total_return_is_numeric
FAILED tests/test_backtester.py::TestBacktester::test_final_value_calculation
FAILED tests/test_backtester.py::TestBacktester::test_signals_length_matches_data
FAILED tests/test_backtester.py::TestBacktester::test_positions_length_matches_data
FAILED tests/test_backtester.py::TestBacktester::test_positions_are_binary - ...
FAILED tests/test_backtester.py::TestBacktester::test_equity_curve_is_series
FAILED tests/test_backtester.py::TestBacktester::test_equity_curve_starts_at_one
FAILED tests/test_backtester.py::TestBacktester::test_buy_and_hold_strategy
FAILED tests/test_backtester.py::TestBacktester::test_multiple_strategies_same_data
FAILED tests/test_backup_manager.py::TestBackupManager::test_list_backups - A...
FAILED tests/test_cache_config.py::test_install_cache_success - AttributeErro...
FAILED tests/test_cache_config.py::test_install_cache_import_error - Attribut...
FAILED tests/test_data_loader.py::TestFetchStockData::test_fetch_multiple_tickers
FAILED tests/test_data_loader_comprehensive.py::test_parse_period - ValueErro...
FAILED tests/test_fully_automated_trader.py::TestFullyAutomatedTrader::test_initialization
FAILED tests/test_fully_automated_trader.py::TestFullyAutomatedTrader::test_calculate_daily_pnl
FAILED tests/test_lightgbm.py::TestLightGBMStrategy::test_generate_signals - ...
FAILED tests/test_logging_config.py::test_setup_logging_creates_directory - F...
FAILED tests/test_meta_learner.py::test_meta_learner_flow - TypeError: MetaLe...
FAILED tests/test_morning_brief.py::TestMorningBrief::test_get_trading_strategy
FAILED tests/test_morning_brief.py::TestMorningBrief::test_generate_brief - A...
FAILED tests/test_multi_timeframe.py::test_resample_data_monthly - ValueError...
FAILED tests/test_multi_timeframe.py::test_add_mtf_features - ValueError: Inv...
FAILED tests/test_multi_timeframe.py::test_add_mtf_features_integration - Val...
FAILED tests/test_optimizer.py::TestOptimizer::test_optimize_combined - Attri...
FAILED tests/test_optimizer.py::TestOptimizer::test_optimize_rsi - AttributeE...
FAILED tests/test_phase30_full_integration.py::TestPhase30FullIntegration::test_dynamic_stop_update
FAILED tests/test_phase35_crypto.py::test_crypto_data_loading - AssertionErro...
FAILED tests/test_phase35_crypto.py::test_fx_data_loading - AssertionError: a...
FAILED tests/test_portfolio_optimizer.py::TestPortfolioOptimizer::test_optimizer_initialization
FAILED tests/test_portfolio_optimizer.py::TestPortfolioOptimizer::test_calculate_portfolio_metrics
FAILED tests/test_portfolio_optimizer.py::TestPortfolioOptimizer::test_find_efficient_frontier
FAILED tests/test_portfolio_optimizer.py::TestPortfolioOptimizer::test_maximize_sharpe_ratio
FAILED tests/test_portfolio_optimizer.py::TestPortfolioOptimizer::test_minimize_variance
FAILED tests/test_portfolio_optimizer.py::TestPortfolioOptimizer::test_risk_parity
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_initialization
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_filter_signals_by_confidence
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_filter_signals_by_expected_return
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_filter_signals_empty
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_generate_chart
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_is_quiet_hours
FAILED tests/test_smart_notifier.py::TestSmartNotifier::test_format_signal_message
FAILED tests/test_strategies_base.py::test_analyze_empty - KeyError: 'Close'
FAILED tests/test_transformer_model.py::TestTemporalFusionTransformer::test_attention_weights
FAILED tests/test_transformer_model.py::TestTransformerStrategy::test_strategy_confidence_score
FAILED tests/test_transformer_model.py::TestTransformerIntegration::test_ensemble_with_transformer
===== 48 failed, 572 passed, 1 skipped, 14 warnings in 104.00s (0:01:44) ======
