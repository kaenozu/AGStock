# 🚀 AGStock 改善提案書 (2025-11-27)

現状のコードベース分析に基づき、予測精度の向上とシステムパフォーマンスの改善に向けた具体的な提案をまとめました。

## 1. 🎯 予測精度の向上 (Prediction Accuracy)

現在、`RandomForest`, `LightGBM`, `LSTM` の3つのモデルと、それらを組み合わせた `EnsembleStrategy` が実装されています。これらをさらに強化するための提案です。

### A. ハイパーパラメータ自動調整 (Auto-ML)
現状のモデルはパラメータがハードコードされています（例: `n_estimators=100`, `epochs=5`）。市場環境に合わせて最適なパラメータを探索する仕組みを導入します。

*   **提案**: **Optuna** を導入し、定期的に（例: 週末）最適なハイパーパラメータを探索・保存するパイプラインを構築する。
*   **期待効果**: モデルの適合不足や過学習を防ぎ、予測精度を 5-10% 向上させる。

### B. 特徴量エンジニアリングの強化
現在は基本的なテクニカル指標（RSI, SMA, Volatility）が中心です。より高度な特徴量を追加し、AIが捉えられるパターンを増やします。

*   **提案**:
    1.  **周波数解析**: フーリエ変換やウェーブレット変換を用いて、価格変動の周期性を特徴量化する。
    2.  **センチメントスコア**: ニュースやSNSの感情分析スコアを数値特徴量としてモデルに入力する（現在はフィルタリングにのみ使用）。
    3.  **市場間相関**: セクターETFやコモディティ（金、原油）との相関変化を動的な特徴量として追加する。

### C. モデルの多様化
現在のアンサンブルは決定木系とLSTMです。異なる性質を持つモデルを追加することで、アンサンブルの効果を高めます。

*   **提案**: **Transformer (Time-Series Transformer)** モデルの導入。長期的な依存関係を捉える能力に優れており、LSTMとは異なる視点での予測が可能。

## 2. ⚡ パフォーマンス向上 (System Performance)

`app.py` や `data_loader.py` の分析から、特にデータ読み込みとUIの応答速度に関する改善の余地が見つかりました。

### A. Streamlit キャッシュの最適化
`src/data_loader.py` の `fetch_stock_data` 関数には `@st.cache_data` デコレータが適用されていません。そのため、ボタンを押すたびにDBアクセスが発生しています。

*   **提案**: `fetch_stock_data` および重い計算処理（バックテスト、ML予測）に `@st.cache_data` または `@st.cache_resource` を適用する。
*   **期待効果**: 画面遷移や再描画の速度が **数倍〜数十倍** 高速化する。

### B. 非同期データ読み込み (Async I/O)
市場スキャン（Tab 1）では多数の銘柄データを取得しますが、現在は同期的に処理されている可能性があります。

*   **提案**: `aiohttp` や `asyncio` を用いて、データ取得とAPIコールを非同期化する。特にニュース取得やセンチメント分析の並列化に有効。
*   **期待効果**: 「スキャン実行」時の待ち時間を大幅に短縮（例: 30秒 → 5秒）。

### C. データベースの最適化
`stock_data.db` (SQLite) のクエリパフォーマンスを改善します。

*   **提案**:
    1.  `ticker` と `date` カラムに複合インデックスを作成する。
    2.  不要な古いデータを定期的にアーカイブ/削除する「Vacuum」処理を自動化する。

## 3. 📅 実装ロードマップ案

| フェーズ | タスク | 難易度 | 期間目安 |
| :--- | :--- | :---: | :---: |
| **Phase 1** | **Streamlitキャッシュ導入 & DBインデックス** (即効性あり) | 低 | 1日 |
| **Phase 2** | **Optunaによるパラメータ調整スクリプト作成** | 中 | 2-3日 |
| **Phase 3** | **非同期データ読み込みの実装** | 高 | 3-4日 |
| **Phase 4** | **特徴量追加 & Transformerモデル実験** | 高 | 1週間~ |

まずは **Phase 1 (キャッシュ導入)** から着手することを強く推奨します。ユーザー体験が劇的に改善されます。
