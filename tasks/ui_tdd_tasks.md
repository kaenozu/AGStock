# UI改善・TDD実装タスク一覧

以下は、株式ダッシュボードのUI改善をTDDで実装するためのタスク群です。各タスクでは、仕様ドキュメントの更新 → ユニットテスト実装 → 実装コード追加 → リファクタリングの順で進めます。

## 1. カラートークンと状態マッピング
- UI用の配色トークンと状態別カラー（成功/警告/エラー/情報）を設定ファイルに切り出す。
- 新規状態追加時のマッピング破綻を検知するユニットテストを作成。
- コンポーネントがトークン経由で色を参照するようにリファクタリング。

## 2. パフォーマンスチャートの期間フィルタ
- 1W/1M/3M/YTD/カスタムレンジのフィルタリング仕様を整理し、欠損・異常値時のデフォルト挙動を定義。
- 期間フィルタ適用後のデータ点数と描画用変換を検証するテストを追加。
- フィルタロジックと描画コンポーネントを分離して実装。

## 3. セクター別ヒートマップ
- 面積比（時価総額/保有比率）とパフォーマンス色のレジェンド仕様を確定。
- カテゴリ追加時に面積配分・色レジェンドが破綻しないことをテスト。
- 描画用データ整形ロジックを実装し、ヒートマップコンポーネントを更新。

## 4. 注文履歴テーブルのフィルタリングとページネーション
- 期間/銘柄/ステータスの複合フィルタ仕様、ページサイズ、オフセット計算を定義。
- クエリ生成とページネーション計算をカバーするユニットテストを追加。
- テーブルコンポーネントをフィルタ・ページネーション対応へ改修し、CSVエクスポートを確認。

## 5. アラートセンターのステートマシン
- アラートの状態遷移（作成→発火→スヌーズ→解消）と通知条件を明文化。
- 遷移の有効性と無効パスを検証するステートマシンテストを追加。
- 通知UI・操作ボタンが状態に応じて活性/非活性を切り替えるよう実装。

## 6. オフライン/低遅延対応とローディングUI
- ローディング骨格表示、最後の更新時刻表示、失敗時の再試行挙動を仕様化。
- バックオフ上限とリトライ回数を検証するテストを追加。
- フェッチエラー時のUIメッセージと再試行ボタンを実装。

## 7. アクセシビリティとショートカット
- 主要操作（タブ切替、銘柄検索、期間変更）に対するキーボードショートカットとフォーカス管理ルールを定義。
- ARIA属性とフォーカス遷移を検証するE2Eテストケースを設計。
- キーボードイベントとフォーカス制御を実装し、既存コンポーネントを対応。

## 8. オンボーディングツアー
- 重要操作（銘柄登録、アラート設定、期間切替）のツアーステップとスキップ時の保持状態を設計。
- ステップ進行とスキップ後の再開位置を検証するテストを追加。
- ツアーUIコンポーネントを実装し、状態保持ロジックを統合。

## 9. ログ/監査ビュー
- 自動売買の判断根拠（シグナル、閾値、モデルバージョン）の表示項目と並び順を定義。
- フィルタとソートの安定性を検証するテストを追加。
- ログビューのデータ取得と表示コンポーネントを実装。

## 10. データ指標ツールチップ
- CAGR、Sharpe、最大ドローダウンなどの算出式・期間・小数点精度を仕様化。
- 表示文言と計算期間の整合性を検証するコンフィグテストを追加。
- 指標コンポーネントにツールチップを実装し、式の変更がテストで検知できるようにする。

---
各タスクは「仕様更新→テスト追加→実装→リファクタリング」のTDDサイクルを厳守し、PRではテストの差分と仕様差分を明示してください。
